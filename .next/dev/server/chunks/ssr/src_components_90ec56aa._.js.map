{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/rose/Documents/this_month/write-content/best-ai-text-writer.com/src/components/Header.tsx"],"sourcesContent":["'use client';\n\nimport React from 'react';\nimport { PenLine, Zap, Coins, Layers, PanelLeftClose, PanelRightClose, History, Settings } from 'lucide-react';\nimport { ContentScore } from '../types';\nimport { useAppStore } from '@/store/useAppStore';\n\ninterface HeaderProps {\n    sessionCost?: number;\n    sessionTokens?: number;\n    showInput: boolean;\n    showSidebar: boolean;\n    onToggleInput: () => void;\n    onToggleSidebar: () => void;\n    onToggleChangelog: () => void;\n    onToggleSettings: () => void;\n    contentScore: ContentScore;\n    displayScale: number;\n    onDisplayScaleChange: (scale: number) => void;\n}\n\nexport const Header: React.FC<HeaderProps> = ({\n    sessionCost = 0,\n    sessionTokens = 0,\n    showInput,\n    showSidebar,\n    onToggleInput,\n    onToggleSidebar,\n    onToggleChangelog,\n    onToggleSettings,\n    contentScore,\n    displayScale,\n    onDisplayScaleChange\n}) => {\n    const { modelFlash } = useAppStore();\n    const decreaseScale = () => onDisplayScaleChange(displayScale - 0.1);\n    const increaseScale = () => onDisplayScaleChange(displayScale + 0.1);\n\n    return (\n        // Refactoring UI: Use shadow instead of border-b for elevation, cleaner look\n        <header className=\"bg-white h-16 flex items-center justify-between px-6 flex-shrink-0 z-30 shadow-sm relative\">\n            <div className=\"flex items-center space-x-4\">\n                <div className=\"flex items-center space-x-3\">\n                    <div className=\"bg-gradient-to-br from-blue-600 to-blue-700 p-2 rounded-xl shadow-md shadow-blue-200\">\n                        <PenLine className=\"w-5 h-5 text-white\" />\n                    </div>\n                    <div className=\"hidden md:flex flex-col\">\n                        <h1 className=\"text-lg font-bold bg-clip-text text-transparent bg-gradient-to-r from-gray-900 to-gray-600 leading-tight\">\n                            Ai Text Writer <span className=\"text-blue-600\">Pro</span> - Best AI Content Generator\n                        </h1>\n                        <button\n                            onClick={onToggleChangelog}\n                            className=\"text-[10px] text-gray-400 hover:text-blue-600 transition-colors flex items-center gap-1 w-fit group\"\n                        >\n                            <History className=\"w-3 h-3 group-hover:rotate-12 transition-transform\" />\n                            <span>v1.4.0 Changelog</span>\n                        </button>\n                    </div>\n                </div>\n\n                {/* Zen Mode Toggles */}\n                <div className=\"flex items-center gap-1 bg-gray-50 p-1 rounded-lg ml-4 border border-gray-100\">\n                    <button\n                        onClick={onToggleInput}\n                        className={`p-1.5 rounded-md transition-all ${showInput ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-400 hover:text-gray-600'}`}\n                        title=\"Toggle Input Panel\"\n                    >\n                        <PanelLeftClose className={`w-4 h-4 transition-transform ${!showInput ? 'rotate-180' : ''}`} />\n                    </button>\n                    <button\n                        onClick={onToggleSidebar}\n                        className={`p-1.5 rounded-md transition-all ${showSidebar ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-400 hover:text-gray-600'}`}\n                        title=\"Toggle Analysis Sidebar\"\n                    >\n                        <PanelRightClose className={`w-4 h-4 transition-transform ${!showSidebar ? 'rotate-180' : ''}`} />\n                    </button>\n                </div>\n\n                {/* Display font sizing */}\n                <div className=\"hidden md:flex items-center gap-1 bg-gray-50 p-1 rounded-lg border border-gray-100 ml-2\">\n                    <button\n                        onClick={decreaseScale}\n                        className=\"px-2 py-1 text-[10px] font-bold text-gray-500 hover:text-gray-700 hover:bg-white rounded\"\n                        title=\"縮小顯示字級\"\n                    >\n                        A-\n                    </button>\n                    <div className=\"px-2 py-1 text-[10px] font-bold text-gray-500 bg-white rounded border border-gray-100\">\n                        {Math.round(displayScale * 100)}%\n                    </div>\n                    <button\n                        onClick={increaseScale}\n                        className=\"px-2 py-1 text-[10px] font-bold text-gray-500 hover:text-gray-700 hover:bg-white rounded\"\n                        title=\"放大顯示字級\"\n                    >\n                        A+\n                    </button>\n                </div>\n            </div>\n\n            {/* Variable Reward: Content Score Indicator */}\n            <div className=\"hidden xl:flex items-center gap-3 mx-auto\">\n                <div className=\"flex flex-col items-end\">\n                    <span className=\"text-[10px] font-bold text-gray-400 uppercase tracking-wider\">Content Score</span>\n                    <span className={`text-sm font-bold ${contentScore.color}`}>{contentScore.label}</span>\n                </div>\n                <div className=\"relative w-10 h-10 flex items-center justify-center\">\n                    <svg className=\"w-full h-full -rotate-90\" viewBox=\"0 0 36 36\">\n                        <path className=\"text-gray-100\" d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"3\" />\n                        <path className={`${contentScore.color} transition-all duration-1000 ease-out`} strokeDasharray={`${contentScore.value}, 100`} d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"3\" />\n                    </svg>\n                    <span className={`absolute text-[10px] font-bold ${contentScore.color}`}>{contentScore.value}</span>\n                </div>\n            </div>\n\n            <div className=\"flex items-center gap-4\">\n                {/* Stats Dashboard */}\n                <div className=\"flex items-center bg-gray-50 rounded-lg border border-gray-200 p-1\">\n                    <div className=\"flex flex-col items-end px-3 py-0.5 border-r border-gray-200\">\n                        <span className=\"text-[10px] text-gray-400 font-bold uppercase tracking-wider flex items-center gap-1\">\n                            <Layers className=\"w-3 h-3\" /> Tokens\n                        </span>\n                        <span className=\"text-sm font-mono font-medium text-gray-600\">\n                            {sessionTokens.toLocaleString()}\n                        </span>\n                    </div>\n                    <div className=\"flex flex-col items-end px-3 py-0.5\">\n                        <span className=\"text-[10px] text-emerald-600/70 font-bold uppercase tracking-wider flex items-center gap-1\">\n                            <Coins className=\"w-3 h-3\" /> Cost\n                        </span>\n                        <span className=\"text-lg font-mono font-bold text-emerald-600 leading-none\">\n                            ${Number(sessionCost || 0).toFixed(4)}\n                        </span>\n                    </div>\n                </div>\n\n                <div className=\"hidden md:flex items-center space-x-1.5 px-3 py-1.5 bg-amber-50 text-amber-700 border border-amber-200 rounded-full shadow-sm\">\n                    <Zap className=\"w-3.5 h-3.5 fill-amber-500 text-amber-600\" />\n                    <span className=\"text-xs font-semibold\">{modelFlash}</span>\n                </div>\n\n                <button\n                    onClick={onToggleSettings}\n                    className=\"p-2 transition-all text-gray-400 hover:text-gray-900 hover:bg-gray-100 rounded-xl\"\n                    title=\"System Settings\"\n                >\n                    <Settings className=\"w-5 h-5\" />\n                </button>\n            </div>\n        </header>\n    );\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 419, "column": 0}, "map": {"version":3,"sources":["file:///Users/rose/Documents/this_month/write-content/best-ai-text-writer.com/src/components/InputForm.tsx"],"sourcesContent":["'use client';\n\nimport React, { useMemo } from 'react';\nimport { SubmitHandler } from 'react-hook-form';\nimport { ArticleConfig, CostBreakdown, GenerationStep, SavedProfile, ScrapedImage, TargetAudience, TokenUsage } from '@/types';\nimport { ArticleFormValues } from '@/schemas/formSchema';\nimport { summarizeBrandContent } from '@/services/research/productFeatureToPainPointMapper';\nimport { WebsiteProfileSection } from './form/WebsiteProfileSection';\nimport { ServiceProductSection } from './form/ServiceProductSection';\nimport { SourceMaterialSection } from './form/SourceMaterialSection';\nimport { LayoutTemplate, Trash2, Sparkles, Settings2, Zap, BookOpen, Loader2, Image as ImageIcon } from 'lucide-react';\nimport { useArticleForm } from '@/hooks/useArticleForm';\nimport { useSemanticFilter } from '@/hooks/useSemanticFilter';\nimport { EMBED_MODEL_ID } from '@/config/constants';\n\ninterface InputFormProps {\n    onGenerate: (config: ArticleConfig) => void;\n    onGenerateSections?: () => void;\n    isGenerating: boolean;\n    isWriting?: boolean;\n    canGenerateSections?: boolean;\n    currentStep: GenerationStep;\n    onAddCost?: (cost: CostBreakdown, usage: TokenUsage) => void;\n    savedProfiles?: SavedProfile[];\n    setSavedProfiles?: (profiles: SavedProfile[]) => void;\n    activeProfile?: SavedProfile | null;\n    onSetActiveProfile?: (profile: SavedProfile | null) => void;\n    inputType: 'text' | 'url';\n    setInputType: (type: 'text' | 'url') => void;\n    brandKnowledge?: string;\n    onShowPlan?: () => void;\n    hasPlan?: boolean;\n}\n\nconst STORAGE_KEY = 'pro_content_writer_inputs_simple_v4';\n\nconst ThresholdInput: React.FC<{\n    value: string;\n    onChange: (val: string) => void;\n    onCommit: (val?: string) => void;\n}> = ({ value, onChange, onCommit }) => {\n    const [localValue, setLocalValue] = React.useState(value);\n\n    React.useEffect(() => {\n        setLocalValue(value);\n    }, [value]);\n\n    const handleCommit = () => {\n        onCommit(localValue);\n    };\n\n    const handleKeyDown = (e: React.KeyboardEvent) => {\n        if (e.key === 'Enter') {\n            e.preventDefault();\n            handleCommit();\n        }\n    };\n\n    return (\n        <input\n            type=\"number\"\n            min=\"0\"\n            max=\"1\"\n            step=\"0.01\"\n            value={localValue}\n            onChange={(e) => {\n                setLocalValue(e.target.value);\n                onChange(e.target.value);\n            }}\n            onBlur={handleCommit}\n            onKeyDown={handleKeyDown}\n            className=\"w-24 px-2 py-1 text-[11px] border border-gray-200 rounded-lg text-gray-800 shadow-inner\"\n        />\n    );\n};\n\nexport const InputForm: React.FC<InputFormProps> = ({\n    onGenerate,\n    onGenerateSections,\n    isGenerating,\n    isWriting = false,\n    canGenerateSections = false,\n    currentStep,\n    onAddCost,\n    savedProfiles = [],\n    setSavedProfiles,\n    activeProfile,\n    onSetActiveProfile,\n    inputType,\n    setInputType,\n    brandKnowledge = '',\n    onShowPlan,\n    hasPlan = false\n}) => {\n    const {\n        register,\n        handleSubmit,\n        setValue,\n        watchedValues,\n        errors,\n        productMode,\n        setProductMode,\n        isSummarizingProduct,\n        setIsSummarizingProduct,\n        refCharCount,\n        refWordCount,\n        scrapedImages,\n        setScrapedImages,\n        isFetchingUrl,\n        fetchAndPopulate,\n        createProfile,\n        updateProfile,\n        deleteProfile,\n        applyProfileToForm,\n        loadProductFromProfile,\n        usableImages,\n        handleClear,\n    } = useArticleForm({\n        brandKnowledge,\n        savedProfiles,\n        setSavedProfiles,\n        activeProfile,\n        onSetActiveProfile,\n        setInputType,\n    });\n\n    const {\n        isChunkModalOpen,\n        setIsChunkModalOpen,\n        chunkPreview,\n        chunkScores,\n        isScoringChunks,\n        isFilteringChunks,\n        filterError,\n        manualKeep,\n        setManualKeep,\n        openFilterModal,\n        applyFilter,\n        semanticThreshold,\n        semanticThresholdInput,\n        setSemanticThresholdInput,\n        commitSemanticThreshold\n    } = useSemanticFilter();\n\n    const semanticThresholdValue = useMemo(() => {\n        const parsed = parseFloat(semanticThresholdInput);\n        if (!Number.isNaN(parsed)) {\n            return Math.min(1, Math.max(0, parsed));\n        }\n        return semanticThreshold;\n    }, [semanticThresholdInput, semanticThreshold]);\n\n    const semanticThresholdLabel = useMemo(\n        () => semanticThresholdValue.toFixed(2),\n        [semanticThresholdValue]\n    );\n\n    const onSubmit: SubmitHandler<ArticleFormValues> = (data) => {\n        const usableImages = scrapedImages.filter(img => !img.ignored);\n        onGenerate({\n            title: data.title,\n            referenceContent: data.referenceContent,\n            sampleOutline: data.sampleOutline,\n            authorityTerms: data.authorityTerms,\n            websiteType: data.websiteType,\n            targetAudience: data.targetAudience,\n            useRag: data.useRag,\n            autoImagePlan: data.autoImagePlan,\n            productRawText: data.productRawText,\n            brandKnowledge: undefined,\n            scrapedImages: usableImages\n        });\n    };\n\n    const handleFetchUrl = async () => {\n        await fetchAndPopulate(watchedValues.urlInput || '');\n    };\n\n    const handleImportProductUrls = async () => {\n        const urlsInput = watchedValues.productUrlList;\n        if (!urlsInput?.trim()) return;\n        setIsSummarizingProduct(true);\n        try {\n            const urls = urlsInput.split('\\n').map(u => u.trim()).filter(u => u.length > 0);\n            const res = await summarizeBrandContent(urls, watchedValues.targetAudience as TargetAudience);\n\n            setValue('productRawText', res.data);\n            setProductMode('text');\n\n            if (onAddCost) onAddCost(res.cost, res.usage);\n\n            updateProfile({ ...watchedValues, productRawText: res.data });\n        } catch (e) {\n            alert('Failed to summarize brand content.');\n        } finally {\n            setIsSummarizingProduct(false);\n        }\n    };\n\n    const handleToggleScrapedImage = (image: ScrapedImage) => {\n        const keyToMatch = image.id || image.url || image.altText;\n        setScrapedImages(prev =>\n            prev.map((img, idx) => {\n                const key = img.id || img.url || img.altText || `${idx}`;\n                if (key !== keyToMatch) return img;\n                return { ...img, ignored: !img.ignored };\n            })\n        );\n    };\n\n    const isReadyToGenerate = useMemo(() => {\n        const hasTitle = (watchedValues.title || '').trim().length > 0;\n        const hasRef = (watchedValues.referenceContent || '').trim().length > 0;\n        return hasTitle && hasRef && !isFetchingUrl && !isSummarizingProduct;\n    }, [watchedValues.title, watchedValues.referenceContent, isFetchingUrl, isSummarizingProduct]);\n\n    const handlePreviewSemanticFilter = () => {\n        const content = (watchedValues.referenceContent || '').trim();\n        const title = (watchedValues.title || '').trim();\n\n        if (!content) {\n            alert('先貼上內容再做語意過濾。');\n            return;\n        }\n\n        openFilterModal(content, title);\n    };\n\n    const handleRunSemanticFilter = async () => {\n        const content = (watchedValues.referenceContent || '').trim();\n        const title = (watchedValues.title || '').trim();\n\n        commitSemanticThreshold();\n\n        const filteredContent = await applyFilter(content, title);\n        if (filteredContent !== null && filteredContent !== undefined) {\n            setValue('referenceContent', filteredContent);\n        }\n    };\n\n    return (\n        <div className=\"flex flex-col h-full bg-slate-50/80 overflow-hidden font-sans\">\n            {/* Header Area */}\n            <div className=\"p-4 pb-2 flex-shrink-0 border-b border-gray-100 bg-white/80 backdrop-blur-sm z-10\">\n                <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-2 text-gray-800\">\n                        <LayoutTemplate className=\"w-4 h-4 text-blue-600\" />\n                        <h2 className=\"text-sm font-bold tracking-tight\">Writer Config</h2>\n                    </div>\n                    <button onClick={handleClear} className=\"text-[10px] text-gray-400 hover:text-red-500 flex items-center gap-1 transition-colors px-2 py-1 hover:bg-red-50 rounded\">\n                        <Trash2 className=\"w-3 h-3\" /> Clear\n                    </button>\n                </div>\n            </div>\n\n            <form onSubmit={handleSubmit(onSubmit)} className=\"flex-1 flex flex-col min-h-0 relative\">\n\n                <div className=\"flex-1 overflow-y-auto custom-scrollbar p-4 space-y-6 pb-24\">\n\n                    <WebsiteProfileSection\n                        register={register}\n                        targetAudience={watchedValues.targetAudience}\n                        websiteType={watchedValues.websiteType}\n                        authorityTerms={watchedValues.authorityTerms}\n                        savedProfiles={savedProfiles}\n                        activeProfile={activeProfile}\n                        brandKnowledge={brandKnowledge}\n                        onCreateProfile={(name) => createProfile(name, watchedValues)}\n                        onUpdateProfile={() => updateProfile(watchedValues)}\n                        onDeleteProfile={deleteProfile}\n                        onLoadProfile={(profile) => {\n                            applyProfileToForm(profile);\n                            setProductMode('text');\n                        }}\n                    />\n\n                    <ServiceProductSection\n                        register={register}\n                        productMode={productMode}\n                        setProductMode={setProductMode}\n                        productRawText={watchedValues.productRawText}\n                        isSummarizingProduct={isSummarizingProduct}\n                        canAnalyzeFromUrls={Boolean(watchedValues.productUrlList)}\n                        savedProfiles={savedProfiles}\n                        activeProfile={activeProfile}\n                        onCreateProfile={(name) => createProfile(name, watchedValues)}\n                        onUpdateProfile={() => updateProfile(watchedValues)}\n                        onLoadProductFromProfile={(profile) => {\n                            loadProductFromProfile(profile);\n                            setProductMode('text');\n                        }}\n                        onAnalyzeFromUrls={handleImportProductUrls}\n                    />\n\n                    <SourceMaterialSection\n                        register={register}\n                        errors={errors}\n                        inputType={inputType}\n                        setInputType={setInputType}\n                        urlValue={watchedValues.urlInput}\n                        refWordCount={refWordCount}\n                        refCharCount={refCharCount}\n                        scrapedImages={scrapedImages}\n                        onToggleScrapedImage={handleToggleScrapedImage}\n                        onFetchUrl={handleFetchUrl}\n                        isFetchingUrl={isFetchingUrl}\n                        onRequestSemanticFilter={handlePreviewSemanticFilter}\n                        canSemanticFilter={(watchedValues.referenceContent || '').trim().length > 0}\n                    />\n\n                    <div className=\"space-y-2\">\n                        <h3 className=\"text-[10px] font-bold uppercase text-gray-400 tracking-wider px-1 flex items-center gap-1\">\n                            <Settings2 className=\"w-3 h-3\" /> Advanced Settings\n                        </h3>\n                        <div className=\"bg-white rounded-xl border border-gray-200 shadow-[0_2px_8px_rgba(0,0,0,0.02)] p-3 space-y-3\">\n                            <div className=\"flex items-center justify-between p-2 rounded-lg hover:bg-gray-50 transition-colors\">\n                                <div className=\"flex items-center gap-3\">\n                                    <div className={`w-8 h-8 rounded-full flex items-center justify-center ${watchedValues.useRag ? 'bg-indigo-100 text-indigo-600' : 'bg-gray-100 text-gray-400'}`}>\n                                        <BookOpen className=\"w-4 h-4\" />\n                                    </div>\n                                    <div>\n                                        <p className=\"text-xs font-bold text-gray-800\">Knowledge Base (RAG)</p>\n                                        <p className=\"text-[10px] text-gray-500\">Use uploaded brand docs for accuracy</p>\n                                    </div>\n                                </div>\n                                <button\n                                    type=\"button\"\n                                    onClick={() => setValue('useRag', !watchedValues.useRag)}\n                                    className={`relative inline-flex h-5 w-9 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 ${watchedValues.useRag ? 'bg-indigo-600' : 'bg-gray-200'}`}\n                                >\n                                    <span className={`inline-block h-3.5 w-3.5 transform rounded-full bg-white transition ${watchedValues.useRag ? 'translate-x-4.5' : 'translate-x-1'}`} />\n                                </button>\n                            </div>\n\n                            <div className=\"flex items-center justify-between p-2 rounded-lg hover:bg-gray-50 transition-colors\">\n                                <div className=\"flex items-center gap-3\">\n                                    <div className={`w-8 h-8 rounded-full flex items-center justify-center ${watchedValues.autoImagePlan ? 'bg-emerald-100 text-emerald-600' : 'bg-gray-100 text-gray-400'}`}>\n                                        <ImageIcon className=\"w-4 h-4\" />\n                                    </div>\n                                    <div>\n                                        <p className=\"text-xs font-bold text-gray-800\">Auto Visual Plan</p>\n                                        <p className=\"text-[10px] text-gray-500\">寫完後自動規劃並生成圖片</p>\n                                    </div>\n                                </div>\n                                <button\n                                    type=\"button\"\n                                    onClick={() => setValue('autoImagePlan', !watchedValues.autoImagePlan)}\n                                    className={`relative inline-flex h-5 w-9 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 ${watchedValues.autoImagePlan ? 'bg-emerald-600' : 'bg-gray-200'}`}\n                                >\n                                    <span className={`inline-block h-3.5 w-3.5 transform rounded-full bg-white transition ${watchedValues.autoImagePlan ? 'translate-x-4.5' : 'translate-x-1'}`} />\n                                </button>\n                            </div>\n                            <p className=\"text-[10px] text-gray-500 px-1\">\n                                關閉可避免尚未按下圖片生成按鈕時就提前觸發。\n                            </p>\n\n                        </div>\n                    </div>\n\n                </div>\n\n                <div className=\"p-4 border-t border-gray-100 bg-white/80 backdrop-blur-sm z-10\">\n                    <div className=\"space-y-2\">\n                        <button\n                            type=\"submit\"\n                            disabled={isGenerating || isWriting || !isReadyToGenerate}\n                            className={`w-full py-3 rounded-xl text-sm font-bold shadow-lg shadow-blue-500/20 flex items-center justify-center gap-2 transition-all transform active:scale-[0.98] ${isGenerating || isWriting || !isReadyToGenerate\n                                ? 'bg-gray-100 text-gray-400 cursor-not-allowed'\n                                : 'bg-gradient-to-r from-blue-600 to-indigo-600 text-white hover:shadow-blue-500/30 hover:brightness-110'\n                                }`}\n                        >\n                            {isGenerating ? (\n                                <>\n                                    <Loader2 className=\"w-4 h-4 animate-spin\" />\n                                    <span>{currentStep.replace(/_/g, ' ').toUpperCase()}...</span>\n                                </>\n                            ) : (\n                                <>\n                                    <Sparkles className=\"w-4 h-4\" />\n                                    <span>Step 1：分析 (供審閱)</span>\n                                </>\n                            )}\n                        </button>\n\n\n\n                        <button\n                            type=\"button\"\n                            onClick={onShowPlan}\n                            disabled={!hasPlan}\n                            className={`w-full py-2.5 rounded-xl text-sm font-semibold flex items-center justify-center gap-2 transition-all border ${hasPlan\n                                ? 'text-blue-700 bg-blue-50 border-blue-100 hover:bg-blue-100'\n                                : 'text-gray-400 bg-gray-50 border-gray-100 cursor-not-allowed'\n                                }`}\n                        >\n                            <LayoutTemplate className=\"w-4 h-4\" />\n                            <span>檢視段落計劃</span>\n                        </button>\n\n                        <p className=\"text-[11px] text-gray-500 text-center\">\n                            先完成分析並檢視結果 (側欄) ，確認後再生成內文段落。\n                        </p>\n                    </div>\n                </div>\n            </form>\n\n            {isChunkModalOpen && (\n                <div className=\"fixed inset-0 z-50 bg-black/25 backdrop-blur-sm flex items-center justify-center p-4\">\n                    <div className=\"bg-white w-full max-w-3xl rounded-2xl shadow-2xl border border-gray-100 overflow-hidden flex flex-col max-h-[85vh]\">\n                        <div className=\"px-5 py-4 border-b border-gray-100 flex items-start justify-between\">\n                            <div>\n                                <p className=\"text-sm font-bold text-gray-900\">語意過濾分段確認</p>\n                                <p className=\"text-[11px] text-gray-500 mt-0.5\">以空白行分段，顯示與標題的語意相似度 (閾值 {semanticThresholdLabel}).</p>\n                            </div>\n                            <button\n                                type=\"button\"\n                                className=\"text-xs text-gray-400 hover:text-gray-600\"\n                                onClick={() => setIsChunkModalOpen(false)}\n                                disabled={isFilteringChunks}\n                            >\n                                ✕\n                            </button>\n                        </div>\n\n                        <div className=\"p-5 space-y-3 overflow-y-auto flex-1 custom-scrollbar\">\n                            {chunkPreview.map((chunk, idx) => (\n                                <div key={`${idx}-${chunk.slice(0, 10)}`} className=\"border border-gray-100 rounded-lg p-3 bg-gray-50/60\">\n                                    <div className=\"flex items-center justify-between text-[11px] text-gray-500 mb-1\">\n                                        <span className=\"font-semibold text-gray-700\">Chunk {idx + 1}</span>\n                                        <div className=\"flex items-center gap-2\">\n                                            <button\n                                                type=\"button\"\n                                                onClick={() => setManualKeep(prev => ({ ...prev, [idx]: !prev[idx] }))}\n                                                className={`px-2 py-0.5 rounded-full border text-[10px] font-semibold transition-colors ${manualKeep[idx]\n                                                    ? 'border-blue-200 bg-blue-50 text-blue-700'\n                                                    : 'border-gray-200 bg-white text-gray-500 hover:border-blue-200 hover:text-blue-600'\n                                                    }`}\n                                            >\n                                                {manualKeep[idx] ? '手動通過' : '手動通過？'}\n                                            </button>\n                                            {typeof chunkScores[idx] === 'number' && !Number.isNaN(chunkScores[idx]) ? (\n                                                <span className={`inline-flex items-center gap-1 px-2 py-0.5 rounded-full border text-[10px] ${chunkScores[idx] >= semanticThresholdValue\n                                                    ? 'border-green-200 text-green-700 bg-green-50'\n                                                    : 'border-amber-200 text-amber-700 bg-amber-50'\n                                                    }`}>\n                                                    相似度 {chunkScores[idx].toFixed(3)}\n                                                </span>\n                                            ) : (\n                                                <span className=\"inline-flex items-center gap-1 px-2 py-0.5 rounded-full border border-gray-200 text-[10px] text-gray-500 bg-white\">\n                                                    {isScoringChunks ? '計算中…' : '等待計算'}\n                                                </span>\n                                            )}\n                                            <span>{chunk.length} chars</span>\n                                        </div>\n                                    </div>\n                                    <p className=\"text-xs text-gray-800 whitespace-pre-wrap leading-relaxed\">{chunk}</p>\n                                </div>\n                            ))}\n                            {chunkPreview.length === 0 && (\n                                <div className=\"text-xs text-gray-500\">尚無可預覽的段落。</div>\n                            )}\n                        </div>\n\n                        {filterError && (\n                            <div className=\"px-5 py-2 text-[11px] text-red-600 border-t border-amber-100 bg-amber-50\">\n                                {filterError}\n                            </div>\n                        )}\n\n                        <div className=\"px-5 py-4 border-t border-gray-100 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\n                            <div className=\"flex flex-col gap-2 text-[11px] text-gray-500\">\n                                <div>\n                                    使用標題向量比對每個段落，低於 {semanticThresholdLabel} 的會被移除；手動通過的段落會強制保留。{isScoringChunks ? ' (計算中...)' : ''}\n                                </div>\n                                <label className=\"flex flex-wrap items-center gap-2 text-gray-700 font-semibold\">\n                                    <div className=\"flex items-center gap-2\">\n                                        <span className=\"text-[10px] uppercase tracking-wide\">閾值</span>\n                                        <span className=\"inline-flex items-center gap-1.5 px-2.5 py-1 bg-amber-50 text-amber-700 border border-amber-200 rounded-full shadow-sm text-[10px] font-semibold\">\n                                            <Zap className=\"w-3 h-3\" />\n                                            <span>{EMBED_MODEL_ID}</span>\n                                        </span>\n                                    </div>\n                                    <ThresholdInput\n                                        value={semanticThresholdInput}\n                                        onChange={setSemanticThresholdInput}\n                                        onCommit={commitSemanticThreshold}\n                                    />\n                                </label>\n                            </div>\n                            <div className=\"flex gap-2\">\n                                <button\n                                    type=\"button\"\n                                    onClick={() => setIsChunkModalOpen(false)}\n                                    disabled={isFilteringChunks || isScoringChunks}\n                                    className=\"px-3 py-2 text-[12px] font-semibold text-gray-600 bg-gray-100 rounded-lg border border-gray-200 hover:bg-gray-200 transition-colors disabled:opacity-50\"\n                                >\n                                    取消\n                                </button>\n                                <button\n                                    type=\"button\"\n                                    onClick={handleRunSemanticFilter}\n                                    disabled={isFilteringChunks || isScoringChunks}\n                                    className=\"px-3 py-2 text-[12px] font-bold text-white bg-gradient-to-r from-blue-600 to-indigo-600 rounded-lg shadow-md hover:brightness-110 transition-all disabled:opacity-60 flex items-center gap-2\"\n                                >\n                                    {isFilteringChunks ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : null}\n                                    同意並過濾\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1327, "column": 0}, "map": {"version":3,"sources":["file:///Users/rose/Documents/this_month/write-content/best-ai-text-writer.com/src/components/TiptapAdapter.tsx"],"sourcesContent":["import { Editor } from '@tiptap/core';\nimport Image from '@tiptap/extension-image';\nimport Link from '@tiptap/extension-link';\nimport Placeholder from '@tiptap/extension-placeholder';\nimport TextAlign from '@tiptap/extension-text-align';\nimport StarterKit from '@tiptap/starter-kit';\nimport React, { useEffect, useMemo, useRef } from 'react';\nimport { cn } from '../utils/cn';\nimport { AskAiMark } from './editor/AskAiMark';\n\ninterface TiptapAdapterProps {\n    initialHtml: string;\n    placeholder?: string;\n    className?: string;\n    contentClassName?: string;\n    contentStyle?: React.CSSProperties;\n    onChange?: (html: string, plainText: string) => void;\n    onReady?: (api: {\n        getSelectedText: () => string;\n        insertHtml: (html: string) => void;\n        insertImage: (src: string, alt?: string) => void;\n        getPlainText: () => string;\n        getHtml: () => string;\n        setHtml: (html: string) => void;\n        getSelectionRange: () => { from: number; to: number };\n        replaceRange: (range: { from: number; to: number }, html: string) => void;\n        markAskAiRange: (range: { from: number; to: number }, taskId: string) => void;\n        clearAskAiMarks: (taskId?: string) => void;\n        findAskAiRange: (taskId: string) => { from: number; to: number } | null;\n        toggleUnderline: () => void;\n        toggleBold: () => void;\n        toggleItalic: () => void;\n        toggleHeading: (level: 1 | 2 | 3) => void;\n        toggleBlockquote: () => void;\n        toggleBulletList: () => void;\n        toggleOrderedList: () => void;\n        setTextAlign: (align: 'left' | 'center' | 'right' | 'justify') => void;\n        setLink: (href: string) => void;\n        unsetLink: () => void;\n        undo: () => void;\n        redo: () => void;\n        clearBold: (options?: {\n            removeBold?: boolean;\n            removeBlockquotes?: boolean;\n            removeQuotes?: boolean;\n            target?: 'selection' | 'document';\n            scope?: { from: number; to: number };\n        }) => boolean;\n        summarizeFormatting: () => { boldMarks: number; blockquotes: number; quoteChars: number; blocks: Array<{ from: number; to: number; text: string; boldMarks: number; blockquotes: number; quoteChars: number; type: string }> };\n        listCleanupTargets: () => Array<{ from: number; to: number; text: string; boldMarks: number; blockquotes: number; quoteChars: number; type: string }>;\n        focus: () => void;\n    }) => void;\n    containerRef?: React.RefObject<HTMLDivElement>;\n}\n\n// Headless Tiptap adapter: mounts a ProseMirror view on a plain div and exposes a minimal command API.\nexport const TiptapAdapter: React.FC<TiptapAdapterProps> = ({\n    initialHtml,\n    placeholder = 'Start writing...',\n    className,\n    contentClassName,\n    contentStyle,\n    onChange,\n    onReady,\n    containerRef,\n}) => {\n    const editorElementRef = useRef<HTMLDivElement>(null);\n    const editorRef = useRef<Editor | null>(null);\n    const onChangeRef = useRef(onChange);\n    const onReadyRef = useRef(onReady);\n    const contentClassRef = useRef(contentClassName);\n    const contentStyleRef = useRef(contentStyle);\n\n    useEffect(() => {\n        onChangeRef.current = onChange;\n    }, [onChange]);\n\n    useEffect(() => {\n        onReadyRef.current = onReady;\n    }, [onReady]);\n\n    const extensions = useMemo(\n        () => [\n            // Disable built-in link/underline in StarterKit to avoid duplicate extension name warnings.\n            StarterKit.configure({ heading: { levels: [1, 2, 3] }, link: false, underline: false }),\n            Link.configure({\n                autolink: true,\n                linkOnPaste: true,\n                openOnClick: false,\n            }),\n            AskAiMark,\n            Image,\n            TextAlign.configure({\n                types: ['heading', 'paragraph'],\n            }),\n            Placeholder.configure({ placeholder }),\n        ],\n        [placeholder],\n    );\n\n    // Create/destroy the headless editor\n    useEffect(() => {\n        if (!editorElementRef.current) return;\n\n        const editor = new Editor({\n            element: editorElementRef.current,\n            extensions,\n            content: initialHtml,\n            editorProps: {\n                attributes: {\n                    class: cn(\n                        'editor-content prose prose-lg max-w-none focus:outline-none min-h-full pt-0',\n                        contentClassName,\n                    ),\n                    style: contentStyle as any,\n                },\n            },\n            onUpdate: ({ editor }) => {\n                const html = editor.getHTML();\n                const text = editor.state.doc.textBetween(0, editor.state.doc.content.size, ' ');\n                onChangeRef.current?.(html, text);\n            },\n        });\n\n        contentClassRef.current = contentClassName;\n        contentStyleRef.current = contentStyle;\n        editorRef.current = editor;\n\n        const stripMarkdownEmphasis = (options?: {\n            fallbackToDoc?: boolean;\n            stripQuotes?: boolean;\n            stripBlockquoteChars?: boolean;\n            stripAsterisks?: boolean;\n            scope?: { from: number; to: number };\n            dispatch?: boolean;\n        }) => {\n            const ed = editorRef.current;\n            if (!ed) return { changed: false, tr: null as any };\n            const { state } = ed;\n            const { from, to } = options?.scope || state.selection;\n            const hasSelection = from !== to;\n            const targetFrom = hasSelection ? from : options?.fallbackToDoc ? 0 : null;\n            const targetTo = hasSelection ? to : options?.fallbackToDoc ? state.doc.content.size : null;\n            if (targetFrom === null || targetTo === null) return { changed: false, tr: null as any };\n\n            let tr = state.tr;\n            let changed = false;\n            const stripQuotes = options?.stripQuotes !== false;\n            const stripBlockquoteChars = options?.stripBlockquoteChars !== false;\n            const stripAsterisks = options?.stripAsterisks !== false;\n\n            state.doc.nodesBetween(targetFrom, targetTo, (node, pos) => {\n                if (!node.isText || !node.text) return;\n\n                const nodeStart = pos;\n                const nodeEnd = pos + node.nodeSize;\n                const clampedFrom = Math.max(nodeStart, targetFrom);\n                const clampedTo = Math.min(nodeEnd, targetTo);\n                const localFrom = clampedFrom - nodeStart;\n                const localTo = clampedTo - nodeStart;\n\n                const segment = node.text.slice(localFrom, localTo);\n                let cleanedSegment = segment;\n                if (stripAsterisks) cleanedSegment = cleanedSegment.replace(/\\*/g, '');\n                if (stripBlockquoteChars) cleanedSegment = cleanedSegment.replace(/>/g, '');\n                if (stripQuotes) cleanedSegment = cleanedSegment.replace(/[\\\"“”「」]/g, '');\n\n                if (segment === cleanedSegment) return;\n\n                const newText = node.text.slice(0, localFrom) + cleanedSegment + node.text.slice(localTo);\n                const mappedFrom = tr.mapping.map(nodeStart);\n                const mappedTo = tr.mapping.map(nodeEnd);\n                tr = tr.replaceRangeWith(\n                    mappedFrom,\n                    mappedTo,\n                    state.schema.text(newText, node.marks),\n                );\n                changed = true;\n            });\n\n            if (changed) {\n                if (options?.dispatch === false) {\n                    return { changed, tr };\n                }\n                ed.view.dispatch(tr);\n            }\n            return { changed, tr };\n        };\n\n        const summarizeFormatting = () => {\n            const ed = editorRef.current;\n            if (!ed) return { boldMarks: 0, blockquotes: 0, quoteChars: 0, blocks: [] };\n            const boldMark = ed.state.schema.marks.bold;\n            let boldMarks = 0;\n            let blockquotes = 0;\n            let quoteChars = 0;\n            const blocks: Array<{ from: number; to: number; text: string; boldMarks: number; blockquotes: number; quoteChars: number; type: string }> = [];\n\n            ed.state.doc.descendants((node, pos) => {\n                if (node.type.name === 'blockquote') {\n                    blockquotes += 1;\n                }\n\n                if (node.isText && node.text) {\n                    if (boldMark && node.marks.some(mark => mark.type === boldMark)) {\n                        boldMarks += 1;\n                    }\n                    const matches = node.text.match(/[\\\"“”「」]/g);\n                    if (matches) {\n                        quoteChars += matches.length;\n                    }\n                }\n\n                if (node.isBlock) {\n                    let blockBold = node.type.name === 'blockquote' ? 1 : 0;\n                    let blockBlockquote = node.type.name === 'blockquote' ? 1 : 0;\n                    let blockQuotes = 0;\n\n                    node.descendants((child) => {\n                        if (child.type.name === 'blockquote') {\n                            blockBlockquote += 1;\n                        }\n                        if (child.isText && child.text) {\n                            if (boldMark && child.marks.some(mark => mark.type === boldMark)) {\n                                blockBold += 1;\n                            }\n                            const matches = child.text.match(/[\\\"“”「」]/g);\n                            if (matches) {\n                                blockQuotes += matches.length;\n                            }\n                        }\n                    });\n\n                    const text = node.textBetween(0, node.content.size, ' ', ' ').trim();\n                    blocks.push({\n                        from: pos,\n                        to: pos + node.nodeSize,\n                        text,\n                        boldMarks: blockBold,\n                        blockquotes: blockBlockquote,\n                        quoteChars: blockQuotes,\n                        type: node.type.name,\n                    });\n                }\n            });\n\n            return { boldMarks, blockquotes, quoteChars, blocks };\n        };\n\n        const listCleanupTargets = () => {\n            const summary = summarizeFormatting();\n            return summary.blocks.filter(b => b.boldMarks > 0 || b.blockquotes > 0 || b.quoteChars > 0);\n        };\n\n        if (onReadyRef.current) {\n            const api = {\n                getSelectedText: () => {\n                    const { from, to } = editor.state.selection;\n                    if (from === to) return '';\n                    return editor.state.doc.textBetween(from, to, ' ');\n                },\n                insertHtml: (html: string) => editor.chain().focus().insertContent(html).run(),\n                insertImage: (src: string, alt: string = '') =>\n                    editor.chain().focus().setImage({ src, alt }).run(),\n                getPlainText: () => editor.state.doc.textBetween(0, editor.state.doc.content.size, ' '),\n                getHtml: () => editor.getHTML(),\n                setHtml: (html: string) => editor.commands.setContent(html),\n                getSelectionRange: () => {\n                    const { from, to } = editor.state.selection;\n                    return { from, to };\n                },\n                replaceRange: (range, html: string) =>\n                    editor.chain().focus().insertContentAt(range, html).run(),\n                markAskAiRange: (range, taskId) => {\n                    editor.chain().setTextSelection(range).setAskAiMark({ taskId }).run();\n                },\n                clearAskAiMarks: (taskId) => {\n                    const ed = editorRef.current;\n                    if (!ed) return;\n                    const { state } = ed;\n                    const askAiMark = state.schema.marks.askai;\n                    if (!askAiMark) return;\n                    let tr = state.tr;\n                    state.doc.descendants((node, pos) => {\n                        if (!node.isText) return;\n                        node.marks.forEach(mark => {\n                            if (mark.type !== askAiMark) return;\n                            if (taskId && mark.attrs.taskId !== taskId) return;\n                            tr = tr.removeMark(pos, pos + node.nodeSize, askAiMark);\n                        });\n                    });\n                    if (tr.docChanged) {\n                        ed.view.dispatch(tr);\n                    }\n                },\n                findAskAiRange: (taskId) => {\n                    const ed = editorRef.current;\n                    if (!ed) return null;\n                    const { state } = ed;\n                    const askAiMark = state.schema.marks.askai;\n                    if (!askAiMark) return null;\n                    let from: number | null = null;\n                    let to: number | null = null;\n                    state.doc.descendants((node, pos) => {\n                        if (!node.isText) return;\n                        const hasMark = node.marks.some(mark => mark.type === askAiMark && mark.attrs.taskId === taskId);\n                        if (!hasMark) return;\n                        const start = pos;\n                        const end = pos + node.nodeSize;\n                        from = from === null ? start : Math.min(from, start);\n                        to = to === null ? end : Math.max(to, end);\n                    });\n                    if (from === null || to === null) return null;\n                    return { from, to };\n                },\n                toggleUnderline: () => editor.chain().focus().toggleUnderline().run(),\n                toggleBold: () => {\n                    stripMarkdownEmphasis();\n                    return editor.chain().focus().toggleBold().run();\n                },\n                toggleItalic: () => editor.chain().focus().toggleItalic().run(),\n                toggleHeading: (level: 1 | 2 | 3) => editor.chain().focus().toggleHeading({ level }).run(),\n                toggleBlockquote: () => editor.chain().focus().toggleBlockquote().run(),\n                toggleBulletList: () => editor.chain().focus().toggleBulletList().run(),\n                toggleOrderedList: () => editor.chain().focus().toggleOrderedList().run(),\n                setTextAlign: (align: 'left' | 'center' | 'right' | 'justify') =>\n                    editor.chain().focus().setTextAlign(align).run(),\n                setLink: (href: string) => editor.chain().focus().extendMarkRange('link').setLink({ href }).run(),\n                unsetLink: () => editor.chain().focus().unsetLink().run(),\n                undo: () => editor.chain().focus().undo().run(),\n                redo: () => editor.chain().focus().redo().run(),\n                clearBold: (options) => {\n                    const ed = editorRef.current;\n                    if (!ed) return false;\n                    const { state } = ed;\n                    const removeBold = options?.removeBold !== false;\n                    const removeBlockquotes = options?.removeBlockquotes !== false;\n                    const removeQuotes = options?.removeQuotes !== false;\n                    const targetDocument = options?.target === 'document';\n                    const customScope = options?.scope;\n                    const { from, to } = state.selection;\n                    const hasSelection = from !== to;\n                    const scopeFrom = customScope?.from ?? (targetDocument || !hasSelection ? 0 : from);\n                    const scopeTo = customScope?.to ?? (targetDocument || !hasSelection ? state.doc.content.size : to);\n\n                    let changed = false;\n                    const { tr: strippedTr, changed: stripped } = stripMarkdownEmphasis({\n                        fallbackToDoc: targetDocument || !hasSelection,\n                        stripQuotes: removeQuotes,\n                        stripBlockquoteChars: true,\n                        stripAsterisks: true,\n                        scope: { from: scopeFrom, to: scopeTo },\n                        dispatch: false,\n                    });\n\n                    let tr = strippedTr || state.tr;\n                    changed = changed || stripped;\n\n                    if (removeBold) {\n                        const boldMark = state.schema.marks.bold;\n                        if (boldMark) {\n                            state.doc.descendants((node, pos) => {\n                                if (!node.isText) return;\n                                if (!node.marks.some(mark => mark.type === boldMark)) return;\n                                const nodeStart = pos;\n                                const nodeEnd = pos + node.nodeSize;\n                                if (nodeEnd <= scopeFrom || nodeStart >= scopeTo) return;\n                                const mappedFrom = tr.mapping.map(pos);\n                                const mappedTo = tr.mapping.map(pos + node.nodeSize);\n                                tr = tr.removeMark(mappedFrom, mappedTo, boldMark);\n                                changed = true;\n                            });\n                        }\n                    }\n\n                    if (removeBlockquotes) {\n                        const blockquoteType = state.schema.nodes.blockquote;\n                        if (blockquoteType) {\n                            state.doc.descendants((node, pos) => {\n                                if (node.type !== blockquoteType) return;\n                                const nodeStart = pos;\n                                const nodeEnd = pos + node.nodeSize;\n                                if (nodeEnd <= scopeFrom || nodeStart >= scopeTo) return;\n                                const mappedFrom = tr.mapping.map(nodeStart);\n                                const mappedTo = tr.mapping.map(nodeEnd);\n                                tr = tr.replaceWith(mappedFrom, mappedTo, node.content);\n                                changed = true;\n                            });\n                        }\n                    }\n\n                    if (changed && tr) {\n                        ed.view.dispatch(tr);\n                    }\n                    return changed;\n                },\n                summarizeFormatting,\n                listCleanupTargets,\n                focus: () => editor.chain().focus().run(),\n            };\n            onReadyRef.current(api);\n        }\n\n        return () => {\n            editor.destroy();\n            editorRef.current = null;\n        };\n    }, [extensions]);\n\n    // Update className/style on content when props change after init\n    useEffect(() => {\n        const el = editorElementRef.current;\n        if (!el) return;\n        const baseClass = cn('editor-content prose prose-lg max-w-none focus:outline-none min-h-full', contentClassName);\n        if (el.className !== baseClass) el.className = baseClass;\n        if (contentStyle) {\n            Object.assign(el.style, contentStyle);\n        }\n        contentClassRef.current = contentClassName;\n        contentStyleRef.current = contentStyle;\n    }, [contentClassName, contentStyle]);\n\n    // Keep content in sync when parent updates initialHtml\n    useEffect(() => {\n        const editor = editorRef.current;\n        if (!editor) return;\n        if (initialHtml !== editor.getHTML()) {\n            editor.commands.setContent(initialHtml);\n        }\n    }, [initialHtml]);\n\n    return (\n        <div\n            ref={containerRef}\n            className={cn('flex-1 bg-white flex flex-col min-h-0 overflow-hidden relative', className)}\n        >\n            <div className=\"flex-1 min-h-0 overflow-hidden\">\n                <div className=\"h-full overflow-y-auto custom-scrollbar\">\n                    <div ref={editorElementRef} className=\"h-full\" />\n                </div>\n            </div>\n        </div>\n    );\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1768, "column": 0}, "map": {"version":3,"sources":["file:///Users/rose/Documents/this_month/write-content/best-ai-text-writer.com/src/components/AskAiSelection.tsx"],"sourcesContent":["import React, { useEffect, useMemo, useRef, useState } from 'react';\nimport { createPortal } from 'react-dom';\nimport {\n    Wand2,\n    PenLine,\n    Sparkles,\n    Smile,\n    MessageSquarePlus,\n    List,\n    ListOrdered,\n    Table,\n    CheckSquare,\n    Quote,\n    ArrowRight,\n    Loader2,\n    X,\n} from 'lucide-react';\n\ntype AskAiMode = 'edit' | 'format';\n\ntype PresetId =\n    | 'rephrase'\n    | 'shorten'\n    | 'elaborate'\n    | 'formal'\n    | 'casual'\n    | 'bulletise'\n    | 'summarise';\n\ntype FormatId =\n    | 'bullet'\n    | 'ordered'\n    | 'table-2'\n    | 'table-3'\n    | 'checklist'\n    | 'quote'\n    | 'markdown-clean';\n\ninterface RunActionInput {\n    selectedText: string;\n    mode: AskAiMode;\n    preset?: PresetId | FormatId;\n    prompt?: string;\n    taskId?: string;\n}\n\ninterface AskAiSelectionProps {\n    onRunAction?: (input: RunActionInput) => Promise<string>;\n    onInsert?: (html: string, taskId?: string) => void;\n    onLockSelectionRange?: (taskId: string) => void;\n    badgeContainerRef?: React.RefObject<HTMLElement>;\n    onHighlightTask?: (taskId: string) => void;\n}\n\n/**\n * Floating Ask AI UI for acting on highlighted text.\n * Designed as a standalone component so we can mount it in any editor surface.\n */\nexport const AskAiSelection: React.FC<AskAiSelectionProps> = ({\n    onRunAction,\n    onInsert,\n    onLockSelectionRange,\n    badgeContainerRef,\n    onHighlightTask,\n}) => {\n    const askAiRootAttr = { 'data-askai-ui': 'true' };\n    const [selectionText, setSelectionText] = useState('');\n    const [selectionRect, setSelectionRect] = useState<DOMRect | null>(null);\n    const [mode, setMode] = useState<AskAiMode>('edit');\n    const [showFormatMenu, setShowFormatMenu] = useState(false);\n    const [customPrompt, setCustomPrompt] = useState('');\n    const [previewTitle, setPreviewTitle] = useState('');\n    const [isPreviewOpen, setIsPreviewOpen] = useState(false);\n    const [taskSelectionText, setTaskSelectionText] = useState('');\n    const [tasks, setTasks] = useState<AskAiTask[]>([]);\n    const [activeTaskId, setActiveTaskId] = useState<string | null>(null);\n    const selectionRangeRef = useRef<Range | null>(null);\n    const taskRangesRef = useRef<Record<string, Range | null>>({});\n    const toolbarRef = useRef<HTMLDivElement | null>(null);\n    const previewRef = useRef<HTMLDivElement | null>(null);\n    const [toolbarSize, setToolbarSize] = useState({ width: 72, height: 200 });\n    const [previewHtml, setPreviewHtml] = useState<string | null>(null);\n\n    interface AskAiTask {\n        id: string;\n        title: string;\n        selectionText: string;\n        status: 'running' | 'done' | 'error';\n        html?: string | null;\n        mode: AskAiMode;\n    }\n\n    const editPresets: { id: PresetId; label: string }[] = [\n        { id: 'rephrase', label: 'Rephrase' },\n        { id: 'shorten', label: 'Shorten' },\n        { id: 'elaborate', label: 'Elaborate' },\n        { id: 'formal', label: 'More formal' },\n        { id: 'casual', label: 'More casual' },\n        { id: 'bulletise', label: 'Bulletise' },\n        { id: 'summarise', label: 'Summarise' },\n    ];\n\n    const formatTemplates: { id: FormatId; label: string; icon: React.ReactNode }[] = [\n        { id: 'bullet', label: 'Bullet list', icon: <List className=\"w-4 h-4\" /> },\n        { id: 'ordered', label: 'Numbered list', icon: <ListOrdered className=\"w-4 h-4\" /> },\n        { id: 'table-2', label: 'Table (2 columns)', icon: <Table className=\"w-4 h-4\" /> },\n        { id: 'table-3', label: 'Table (3 columns)', icon: <Table className=\"w-4 h-4\" /> },\n        { id: 'checklist', label: 'Checklist', icon: <CheckSquare className=\"w-4 h-4\" /> },\n        { id: 'quote', label: 'Quote block', icon: <Quote className=\"w-4 h-4\" /> },\n        { id: 'markdown-clean', label: 'Markdown clean-up', icon: <Sparkles className=\"w-4 h-4\" /> },\n    ];\n\n    const toolbarVisible = selectionText.length > 0 && !!selectionRect;\n\n    const viewportSafeArea = 12;\n    const activeTask = activeTaskId ? tasks.find(t => t.id === activeTaskId) : null;\n    const completedCount = tasks.filter(t => t.status === 'done').length;\n    const totalCount = tasks.length;\n    const isActiveLoading = activeTask?.status === 'running';\n\n    const toolbarPosition = useMemo(() => {\n        if (!selectionRect) return { top: viewportSafeArea, left: viewportSafeArea };\n        const toolbarWidth = toolbarSize.width || 72;\n        const toolbarHeight = toolbarSize.height || 200;\n        const baseLeft = selectionRect.right + 8; // position to the right of selection\n        const maxLeft = window.innerWidth - toolbarWidth - viewportSafeArea;\n        const clampedLeft = Math.max(viewportSafeArea, Math.min(baseLeft, maxLeft));\n        const baseTop =\n            selectionRect.top + selectionRect.height / 2 - toolbarHeight / 2; // vertical center to selection\n        const maxTop = window.innerHeight - toolbarHeight - viewportSafeArea;\n        const clampedTop = Math.max(viewportSafeArea, Math.min(baseTop, maxTop));\n        return { top: clampedTop, left: clampedLeft };\n    }, [selectionRect, toolbarSize]);\n\n    const isInsideUi = (target: EventTarget | null | undefined) => {\n        return target instanceof Element && target.closest('[data-askai-ui=\"true\"]');\n    };\n\n    const resolveSelectionRect = (range: Range): DOMRect | null => {\n        const rect = range.getBoundingClientRect();\n        if (rect && (rect.width > 0 || rect.height > 0)) return rect;\n        const clientRects = Array.from(range.getClientRects()).filter(r => r.width > 0 || r.height > 0);\n        if (clientRects.length === 0) return null;\n        const left = Math.min(...clientRects.map(r => r.left));\n        const right = Math.max(...clientRects.map(r => r.right));\n        const top = Math.min(...clientRects.map(r => r.top));\n        const bottom = Math.max(...clientRects.map(r => r.bottom));\n        return new DOMRect(left, top, right - left, bottom - top);\n    };\n\n    const resetFloatingUi = () => {\n        setSelectionText('');\n        setSelectionRect(null);\n        selectionRangeRef.current = null;\n        setShowFormatMenu(false);\n    };\n\n    const hidePanels = () => {\n        setIsPreviewOpen(false);\n        setActiveTaskId(null);\n    };\n\n    const captureSelection = () => {\n        requestAnimationFrame(() => {\n            const sel = window.getSelection();\n            if (!sel || sel.rangeCount === 0) {\n                resetFloatingUi();\n                return;\n            }\n            const text = sel.toString().trim();\n            if (!text) {\n                resetFloatingUi();\n                return;\n            }\n            const range = sel.getRangeAt(0);\n            const rect = resolveSelectionRect(range);\n            if (!rect) {\n                resetFloatingUi();\n                return;\n            }\n            setSelectionText(text);\n            setSelectionRect(rect);\n            selectionRangeRef.current = range.cloneRange();\n        });\n    };\n\n    const refreshSelectionRect = () => {\n        const range = selectionRangeRef.current;\n        if (!range) return;\n        const rect = resolveSelectionRect(range);\n        if (rect) {\n            setSelectionRect(rect);\n        }\n    };\n\n    useEffect(() => {\n        const handler = (e: MouseEvent | KeyboardEvent) => {\n            if (isInsideUi(e.target)) return;\n            captureSelection();\n        };\n        const selectionChangeHandler = () => {\n            const activeEl = document.activeElement;\n            const sel = window.getSelection();\n            const anchorElement =\n                sel?.anchorNode instanceof Element ? sel.anchorNode : sel?.anchorNode?.parentElement;\n            if (isInsideUi(activeEl) || isInsideUi(anchorElement)) {\n                return;\n            }\n            captureSelection();\n        };\n        const scrollHandler = () => {\n            refreshSelectionRect();\n        };\n        document.addEventListener('selectionchange', selectionChangeHandler);\n        document.addEventListener('mouseup', handler);\n        document.addEventListener('keyup', handler);\n        window.addEventListener('scroll', scrollHandler, true);\n        window.addEventListener('resize', scrollHandler);\n        return () => {\n            document.removeEventListener('selectionchange', selectionChangeHandler);\n            document.removeEventListener('mouseup', handler);\n            document.removeEventListener('keyup', handler);\n            window.removeEventListener('scroll', scrollHandler, true);\n            window.removeEventListener('resize', scrollHandler);\n        };\n    }, []);\n\n    useEffect(() => {\n        if (!toolbarRef.current) return;\n        const rect = toolbarRef.current.getBoundingClientRect();\n        if (rect.width && rect.height) {\n            setToolbarSize(prev => {\n                if (prev.width === rect.width && prev.height === rect.height) return prev;\n                return { width: rect.width, height: rect.height };\n            });\n        }\n    }, [toolbarVisible, selectionText, showFormatMenu]);\n\n    // Keep panel content pinned to the selected task; do not auto-switch on task updates.\n    useEffect(() => {\n        if (!activeTaskId) return;\n        const current = tasks.find(t => t.id === activeTaskId);\n        if (current) {\n            setPreviewTitle(prev => prev || current.title);\n            setMode(current.mode);\n        }\n    }, [activeTaskId, tasks]);\n\n    const dropdownAnchor = useMemo(() => {\n        const menuWidth = 256; // w-64\n        const desiredLeft = toolbarPosition.left + toolbarSize.width + 12;\n        const maxLeft = window.innerWidth - menuWidth - viewportSafeArea;\n        return {\n            top: toolbarPosition.top,\n            left: Math.max(viewportSafeArea, Math.min(desiredLeft, maxLeft)),\n        };\n    }, [toolbarPosition, toolbarSize]);\n\n    const lockTaskSelection = (overrideText?: string) => {\n        // ALWAYS prefer the current selectionText if we are starting a fresh action (no active task)\n        // or if an override is provided.\n        // We only use taskSelectionText if we are specifically iterating on an existing locked task.\n        const text = (overrideText || selectionText || taskSelectionText).trim();\n\n        if (!text) {\n            alert('請先選取要調整的文字。');\n            return '';\n        }\n\n        // Update the locked text for consistency\n        if (text !== taskSelectionText) {\n            setTaskSelectionText(text);\n            // Clear custom prompt if the text context changed completely\n            setCustomPrompt('');\n        }\n        return text;\n    };\n\n    const runAction = async (input: RunActionInput) => {\n        const effectiveText = lockTaskSelection(input.selectedText);\n        if (!effectiveText) return;\n        setMode(input.mode);\n        setIsPreviewOpen(false);\n        setPreviewTitle(labelForAction(input));\n        setPreviewHtml(null);\n\n        const taskId = `${Date.now()}-${Math.random().toString(36).slice(2, 6)}`;\n        if (selectionRangeRef.current) {\n            taskRangesRef.current[taskId] = selectionRangeRef.current.cloneRange();\n        }\n        onLockSelectionRange?.(taskId);\n        onHighlightTask?.(taskId);\n        const nextTask: AskAiTask = {\n            id: taskId,\n            title: labelForAction(input),\n            selectionText: effectiveText,\n            status: 'running',\n            mode: input.mode,\n        };\n        setTasks(prev => [...prev, nextTask]);\n        setActiveTaskView(taskId);\n\n        const mockResponse = () => {\n            if (input.mode === 'format') {\n                if (input.preset === 'bullet') {\n                    return `<ul class=\"list-disc pl-5\"><li>${effectiveText}</li><li>第二點</li></ul>`;\n                }\n                if (input.preset?.toString().startsWith('table')) {\n                    const cols = input.preset === 'table-3' ? 3 : 2;\n                    const headers = Array.from({ length: cols }, (_, i) => `Column ${i + 1}`).join('</th><th>');\n                    return `<table class=\"table-auto border-collapse w-full\"><thead><tr><th>${headers}</th></tr></thead><tbody><tr>${Array.from({ length: cols }, () => '<td>Value</td>').join('')}</tr></tbody></table>`;\n                }\n                if (input.preset === 'checklist') {\n                    return `<ul class=\"list-none pl-0\"><li>☐ ${effectiveText}</li><li>☐ 下一步</li></ul>`;\n                }\n                if (input.preset === 'quote') {\n                    return `<blockquote class=\"border-l-4 pl-3 italic text-gray-700\">${effectiveText}</blockquote>`;\n                }\n                return `<div>${effectiveText}</div>`;\n            }\n            const promptHint = input.prompt ? `（${input.prompt}）` : '';\n            return `<p>${effectiveText}${promptHint ? ' ' + promptHint : ''}</p>`;\n        };\n\n        try {\n            const html = await (onRunAction ? onRunAction({ ...input, selectedText: effectiveText, taskId }) : Promise.resolve(mockResponse()));\n            setTasks(prev =>\n                prev.map(t =>\n                    t.id === taskId ? { ...t, html, status: 'done' } : t\n                )\n            );\n            if (activeTaskId === taskId) {\n                setPreviewHtml(html);\n                setPreviewTitle(labelForAction(input));\n            }\n        } catch (err) {\n            console.error('Ask AI run failed', err);\n            const errorHtml = '<p class=\"text-red-500\">AI 輸出失敗，請重試。</p>';\n            setTasks(prev =>\n                prev.map(t =>\n                    t.id === taskId ? { ...t, html: errorHtml, status: 'error' } : t\n                )\n            );\n            if (activeTaskId === taskId) {\n                setPreviewHtml(errorHtml);\n                setPreviewTitle(labelForAction(input));\n            }\n        }\n    };\n\n    const setActiveTaskView = (taskId: string | null) => {\n        setActiveTaskId(taskId);\n        if (!taskId) return;\n        const task = tasks.find(t => t.id === taskId);\n        if (!task) return;\n        setPreviewTitle(task.title);\n        setPreviewHtml(task.html || null);\n        setMode(task.mode);\n    };\n\n    const openEditPanel = () => {\n        const text = lockTaskSelection();\n        if (!text) return;\n        setMode('edit');\n        setPreviewTitle('Edit');\n        setPreviewHtml(null);\n        setIsPreviewOpen(true);\n        setCustomPrompt('');\n    };\n\n    const labelForAction = (input: RunActionInput) => {\n        if (input.mode === 'format') {\n            const matched = formatTemplates.find(t => t.id === input.preset);\n            return matched?.label || 'Format';\n        }\n        const matched = editPresets.find(p => p.id === input.preset);\n        return matched?.label || 'Edit';\n    };\n\n    const handleInsert = () => {\n        const activeTask = tasks.find(t => t.id === activeTaskId);\n        const htmlToInsert = activeTask?.html || previewHtml;\n        if (!htmlToInsert) return;\n        if (onInsert) {\n            onInsert(htmlToInsert, activeTaskId || undefined);\n            setActiveTaskId(null);\n            setIsPreviewOpen(false);\n            clearSelectionHighlight();\n            return;\n        }\n        const range = activeTaskId ? taskRangesRef.current[activeTaskId] : selectionRangeRef.current;\n        if (!range) return;\n        const fragment = document.createDocumentFragment();\n        const temp = document.createElement('div');\n        temp.innerHTML = htmlToInsert;\n        while (temp.firstChild) {\n            fragment.appendChild(temp.firstChild);\n        }\n        range.deleteContents();\n        range.insertNode(fragment);\n        if (activeTaskId) {\n            delete taskRangesRef.current[activeTaskId];\n        }\n        setActiveTaskId(null);\n        setIsPreviewOpen(false);\n        clearSelectionHighlight();\n    };\n\n    const clearSelectionHighlight = () => {\n        const sel = window.getSelection();\n        if (sel) {\n            sel.removeAllRanges();\n        }\n    };\n\n    const renderToolbar = () => {\n        if (!toolbarVisible) return null;\n        return (\n            <div\n                data-askai-ui=\"true\"\n                className=\"fixed z-30 flex flex-col bg-white border border-gray-200 shadow-lg rounded-full py-3 px-2 gap-3\"\n                style={{ top: toolbarPosition.top, left: toolbarPosition.left }}\n                ref={toolbarRef}\n            >\n                <ToolbarIcon\n                    icon={<PenLine className=\"w-4 h-4\" />}\n                    label=\"Edit\"\n                    onClick={() => {\n                        setShowFormatMenu(false);\n                        openEditPanel();\n                    }}\n                />\n                <ToolbarIcon\n                    icon={<Sparkles className=\"w-4 h-4\" />}\n                    label=\"Format\"\n                    active={showFormatMenu}\n                    onClick={() => {\n                        setShowFormatMenu(v => !v);\n                        setMode('format');\n                    }}\n                />\n                <ToolbarIcon\n                    icon={<Smile className=\"w-4 h-4\" />}\n                    label=\"Shorten\"\n                    onClick={() => runAction({ mode: 'edit', preset: 'shorten', selectedText: selectionText })}\n                />\n                <ToolbarIcon\n                    icon={<MessageSquarePlus className=\"w-4 h-4\" />}\n                    label=\"Add note\"\n                    onClick={() => runAction({ mode: 'edit', preset: 'elaborate', selectedText: selectionText })}\n                />\n            </div>\n        );\n    };\n\n    const renderFormatMenu = () => {\n        if (!showFormatMenu || !toolbarVisible) return null;\n        return (\n            <DropdownCard anchor={dropdownAnchor}>\n                <div className=\"text-sm font-semibold text-gray-800 mb-2\">Format templates</div>\n                <div className=\"flex flex-col gap-1\">\n                    {formatTemplates.map(template => (\n                        <MenuItem\n                            key={template.id}\n                            label={template.label}\n                            icon={template.icon}\n                            onClick={() => {\n                                runAction({ mode: 'format', preset: template.id, selectedText: taskSelectionText || selectionText });\n                                setShowFormatMenu(false);\n                            }}\n                        />\n                    ))}\n                </div>\n            </DropdownCard>\n        );\n    };\n\n    const handleRunCustomPrompt = () => {\n        runAction({ mode: 'edit', preset: undefined, prompt: customPrompt, selectedText: activeTask?.selectionText || taskSelectionText || selectionText });\n    };\n\n    const renderPreview = () => {\n        if (!isPreviewOpen) return null;\n        return (\n            <div data-askai-ui=\"true\" className=\"fixed inset-0 z-40 flex items-start justify-center overflow-y-auto px-3 py-6\">\n                <div className=\"absolute inset-0 bg-black/5 backdrop-blur-[1px]\" />\n                <div\n                    className=\"relative w-[min(780px,92vw)] bg-white shadow-2xl border border-gray-200 rounded-2xl p-4 max-h-[80vh] flex flex-col overflow-hidden\"\n                    ref={previewRef}\n                >\n                    <div className=\"flex items-center justify-between mb-3\">\n                        <div className=\"flex items-center gap-2 text-sm font-semibold text-gray-900\">\n                            <Wand2 className=\"w-4 h-4 text-purple-500\" />\n                            <span>{previewTitle || (mode === 'format' ? 'Format' : 'Edit')}</span>\n                            {isActiveLoading && <Loader2 className=\"w-4 h-4 animate-spin text-gray-400\" />}\n                        </div>\n                        <button\n                            className=\"p-1 text-gray-500 hover:text-gray-700 rounded-full hover:bg-gray-100\"\n                            onClick={() => hidePanels()}\n                        >\n                            <X className=\"w-4 h-4\" />\n                        </button>\n                    </div>\n\n                    {totalCount > 1 && (\n                        <div className=\"mb-3\">\n                            <select\n                                className=\"w-full px-3 py-2 text-sm border rounded-lg text-gray-700\"\n                                value={activeTaskId || ''}\n                                onChange={e => {\n                                    const next = e.target.value;\n                                    if (!next) return;\n                                    setActiveTaskView(next);\n                                }}\n                            >\n                                {tasks.map((t, idx) => (\n                                    <option key={t.id} value={t.id}>\n                                        Task {idx + 1} — {t.title} ({t.status})\n                                    </option>\n                                ))}\n                            </select>\n                        </div>\n                    )}\n\n                    <div className=\"flex-1 overflow-y-auto space-y-4 pr-1 custom-scrollbar\">\n                        <div className=\"grid md:grid-cols-2 gap-3\">\n                            <div className=\"border border-gray-100 rounded-xl p-3 bg-gray-50 max-h-64 overflow-y-auto custom-scrollbar\">\n                                <div className=\"text-xs font-semibold text-gray-500 mb-2\">Before</div>\n                                <div className=\"text-sm text-gray-800 whitespace-pre-wrap\">{activeTask?.selectionText || taskSelectionText || selectionText}</div>\n                            </div>\n                            <div className=\"border border-purple-100 rounded-xl p-3 bg-purple-50/60 min-h-[140px] max-h-64 overflow-y-auto custom-scrollbar\">\n                                <div className=\"text-xs font-semibold text-purple-600 mb-2\">After</div>\n                                <div\n                                    className=\"text-sm text-gray-900 leading-relaxed\"\n                                    dangerouslySetInnerHTML={{ __html: previewHtml || '<p class=\"text-gray-400\">等待生成...</p>' }}\n                                />\n                            </div>\n                        </div>\n\n                        <div className=\"flex flex-col gap-3\">\n                            {mode === 'edit' && (\n                                <div className=\"flex flex-col gap-2\">\n                                    <textarea\n                                        className=\"w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-purple-500 min-h-[96px] resize-y\"\n                                        placeholder=\"在這裡輸入更長的提示，或貼上具體的修改說明\"\n                                        value={customPrompt}\n                                        onChange={e => setCustomPrompt(e.target.value)}\n                                        onKeyDown={e => {\n                                            if (e.key === 'Enter' && (e.metaKey || e.ctrlKey)) {\n                                                e.preventDefault();\n                                                handleRunCustomPrompt();\n                                            }\n                                        }}\n                                    />\n                                    <div className=\"flex flex-wrap items-center gap-2\">\n                                        <button\n                                            className=\"px-4 py-2 rounded-lg text-sm font-semibold bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-60\"\n                                            onClick={handleRunCustomPrompt}\n                                            disabled={!customPrompt.trim() || isActiveLoading}\n                                        >\n                                            Generate\n                                        </button>\n                                        <select\n                                            className=\"px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-purple-500\"\n                                            onChange={e => {\n                                                const preset = e.target.value as PresetId;\n                                                if (!preset) return;\n                                                runAction({ mode: 'edit', preset, selectedText: activeTask?.selectionText || taskSelectionText || selectionText });\n                                                e.currentTarget.value = '';\n                                            }}\n                                            defaultValue=\"\"\n                                        >\n                                            <option value=\"\" disabled>\n                                                Quick refine\n                                            </option>\n                                            {editPresets.map(p => (\n                                                <option key={p.id} value={p.id}>\n                                                    {p.label}\n                                                </option>\n                                            ))}\n                                        </select>\n                                    </div>\n                                </div>\n                            )}\n                        </div>\n                    </div>\n                    <div className=\"mt-3 flex items-center gap-2 justify-end flex-wrap border-t border-gray-100 pt-3 bg-white\">\n                        {mode !== 'edit' && (\n                            <select\n                                className=\"px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-purple-500\"\n                                onChange={e => {\n                                    const preset = e.target.value as PresetId;\n                                    if (!preset) return;\n                                    runAction({ mode: 'edit', preset, selectedText: activeTask?.selectionText || taskSelectionText || selectionText });\n                                    e.currentTarget.value = '';\n                                }}\n                                defaultValue=\"\"\n                            >\n                                <option value=\"\" disabled>\n                                    Refine\n                                </option>\n                                {editPresets.map(p => (\n                                    <option key={p.id} value={p.id}>\n                                        {p.label}\n                                    </option>\n                                ))}\n                            </select>\n                        )}\n                        {!isActiveLoading && (\n                            <button\n                                className=\"px-4 py-2 rounded-lg text-sm font-semibold flex items-center gap-1 bg-emerald-600 text-white hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed\"\n                                onClick={handleInsert}\n                                disabled={!previewHtml}\n                            >\n                                Replace\n                                <ArrowRight className=\"w-4 h-4\" />\n                            </button>\n                        )}\n                    </div>\n                </div>\n            </div>\n        );\n    };\n    const renderTaskBadge = (placement: 'floating' | 'inline') => {\n        if (totalCount === 0 || isPreviewOpen) return null;\n        const isInline = placement === 'inline';\n        const layoutClasses = isInline\n            ? 'inline-flex items-center gap-2 px-3 py-1.5 rounded-md text-xs font-semibold shadow-sm whitespace-nowrap flex-shrink-0'\n            : 'fixed z-30 bottom-4 left-4 w-16 h-16 rounded-full flex flex-col items-center justify-center gap-1 shadow-lg';\n        return (\n            <button\n                type=\"button\"\n                data-askai-ui=\"true\"\n                className={`${layoutClasses} bg-purple-600 text-white transition-colors hover:bg-purple-500`}\n                onClick={() => {\n                    const lastTask = tasks[tasks.length - 1];\n                    if (lastTask) {\n                        setActiveTaskView(lastTask.id);\n                        setIsPreviewOpen(true);\n                    }\n                }}\n                title=\"Ask AI Tasking\"\n            >\n                <span className=\"text-[10px] leading-none uppercase tracking-wide\">Ask AI</span>\n                <span className=\"text-xs font-semibold leading-none\">\n                    {completedCount}/{totalCount}\n                </span>\n            </button>\n        );\n    };\n\n    if (typeof document === 'undefined') return null;\n\n    const badgeTarget = badgeContainerRef?.current;\n    const badgeNode = renderTaskBadge(badgeTarget ? 'inline' : 'floating');\n\n    return (\n        <>\n            {createPortal(\n                <>\n                    {renderToolbar()}\n                    {renderFormatMenu()}\n                    {renderPreview()}\n                </>,\n                document.body\n            )}\n            {badgeNode && createPortal(badgeNode, badgeTarget || document.body)}\n        </>\n    );\n};\n\nexport type AskAiRunActionInput = RunActionInput;\n\nconst ToolbarIcon: React.FC<{\n    icon: React.ReactNode;\n    label: string;\n    active?: boolean;\n    onClick: () => void;\n}> = ({ icon, label, active, onClick }) => {\n    return (\n        <button\n            className={`w-10 h-10 inline-flex items-center justify-center rounded-full border transition-colors ${active ? 'border-blue-500 bg-blue-50 text-blue-600' : 'border-gray-200 hover:border-blue-300 text-gray-600'\n                }`}\n            onMouseDown={e => e.preventDefault()}\n            onClick={onClick}\n            title={label}\n        >\n            {icon}\n        </button>\n    );\n};\n\nconst DropdownCard: React.FC<{ anchor: { top: number; left: number }; children: React.ReactNode }> = ({\n    anchor,\n    children,\n}) => {\n    return (\n        <div\n            data-askai-ui=\"true\"\n            className=\"fixed z-40 w-64 bg-white border border-gray-200 shadow-xl rounded-2xl p-3\"\n            style={{ top: anchor.top, left: anchor.left }}\n        >\n            {children}\n        </div>\n    );\n};\n\nconst MenuItem: React.FC<{\n    label: string;\n    icon?: React.ReactNode;\n    disabled?: boolean;\n    onClick: () => void;\n}> = ({ label, icon, disabled, onClick }) => {\n    return (\n        <button\n            disabled={disabled}\n            className={`w-full flex items-center gap-2 px-2 py-2 rounded-lg text-sm ${disabled\n                ? 'text-gray-300 cursor-not-allowed'\n                : 'text-gray-800 hover:bg-gray-50 active:bg-gray-100'\n                }`}\n            onMouseDown={e => e.preventDefault()}\n            onClick={onClick}\n        >\n            {icon || <PenLine className=\"w-4 h-4\" />}\n            <span>{label}</span>\n        </button>\n    );\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2840, "column": 0}, "map": {"version":3,"sources":["file:///Users/rose/Documents/this_month/write-content/best-ai-text-writer.com/src/components/RichTextEditor.tsx"],"sourcesContent":["import React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { BookOpen, FileText, Loader2, Type, Copy, X } from 'lucide-react';\nimport { TargetAudience, CostBreakdown, TokenUsage, ScrapedImage, ImageAssetPlan, ProductBrief } from '../types';\nimport { TiptapAdapter } from './TiptapAdapter';\nimport { EditorToolbar } from './editor/EditorToolbar';\nimport { KeyPointsPanel } from './editor/KeyPointsPanel';\nimport { VisualAssetsPanel } from './editor/VisualAssetsPanel';\nimport { MetaPanel } from './editor/MetaPanel';\nimport { ImageGeneratorModal } from './editor/ImageGeneratorModal';\nimport { AskAiSelection } from './AskAiSelection';\nimport { useImageEditor } from '../hooks/useImageEditor';\nimport { useMetaGenerator } from '../hooks/useMetaGenerator';\nimport { useOptionalEditorContext } from './editor/EditorContext';\nimport { useAskAi } from '../hooks/useAskAi';\nimport { useEditorAutosave } from '../hooks/useEditorAutosave';\nimport { smartInjectPoint } from '../services/generation/contentGenerationService';\nimport { useAnalysisStore } from '../store/useAnalysisStore';\n\ntype AskAiMode = 'edit' | 'format';\n\ninterface RichTextEditorProps {\n    initialHtml: string;\n    onChange?: (html: string) => void;\n    keyPoints?: string[];\n    brandExclusivePoints?: string[];\n    checkedPoints?: string[];\n    scrapedImages?: ScrapedImage[];\n    visualStyle?: string;\n    onTogglePoint?: (point: string) => void;\n    targetAudience?: TargetAudience;\n    onAddCost?: (cost: CostBreakdown, usage: TokenUsage) => void;\n    productBrief?: ProductBrief | null;\n    displayScale?: number;\n    articleTitle?: string;\n    onTitleChange?: (value: string) => void;\n    outlineSections?: string[];\n    onRemoveScrapedImage?: (img: ScrapedImage) => void;\n    toolbarExtras?: React.ReactNode;\n}\n\nexport const RichTextEditor: React.FC<RichTextEditorProps> = ({\n    initialHtml,\n    onChange,\n    keyPoints: keyPointsProp = [],\n    brandExclusivePoints: brandPointsProp = [],\n    checkedPoints: checkedPointsProp = [],\n    scrapedImages: scrapedImagesProp = [],\n    visualStyle = '',\n    onTogglePoint,\n    targetAudience = 'zh-TW',\n    onAddCost,\n    productBrief = null,\n    displayScale,\n    articleTitle,\n    onTitleChange,\n    outlineSections = [],\n    onRemoveScrapedImage,\n    toolbarExtras,\n}) => {\n    const ctx = useOptionalEditorContext();\n    const [html, setHtml] = useState(initialHtml);\n    const [charCount, setCharCount] = useState(0);\n    const [wordCount, setWordCount] = useState(0);\n    const [showKeyPoints, setShowKeyPoints] = useState(false);\n    const [showVisualAssets, setShowVisualAssets] = useState(false);\n    const [showMetaPanel, setShowMetaPanel] = useState(false);\n    const [isAiRunning, setIsAiRunning] = useState(false);\n    const effectiveScale = displayScale ?? ctx?.displayScale ?? 1;\n\n    const editorContainerRef = useRef<HTMLDivElement>(null);\n    const askAiBadgeContainerRef = useRef<HTMLDivElement>(null);\n    const hasRestoredDraftRef = useRef(false);\n    const [showCleanupModal, setShowCleanupModal] = useState(false);\n    const [cleanupSummary, setCleanupSummary] = useState({ boldMarks: 0, blockquotes: 0, quoteChars: 0 });\n    const [cleanupBlocks, setCleanupBlocks] = useState<Array<{ from: number; to: number; text: string; boldMarks: number; blockquotes: number; quoteChars: number; type: string }>>([]);\n    const [selectedBlocks, setSelectedBlocks] = useState<Set<string>>(new Set());\n    const [refiningPoint, setRefiningPoint] = useState<string | null>(null);\n    const [hasAutoCheckedPoints, setHasAutoCheckedPoints] = useState(false);\n    const [tiptapApi, setTiptapApi] = useState<{\n        getSelectedText: () => string;\n        insertHtml: (html: string) => void;\n        insertImage: (src: string, alt?: string) => void;\n        getPlainText: () => string;\n        getHtml: () => string;\n        setHtml: (html: string) => void;\n        toggleUnderline: () => void;\n        toggleBold: () => void;\n        toggleItalic: () => void;\n        toggleHeading: (level: 1 | 2 | 3) => void;\n        toggleBlockquote: () => void;\n        toggleBulletList: () => void;\n        toggleOrderedList: () => void;\n        setTextAlign: (align: 'left' | 'center' | 'right' | 'justify') => void;\n        setLink: (href: string) => void;\n        unsetLink: () => void;\n        undo: () => void;\n        redo: () => void;\n        clearBold: (options?: { removeBold?: boolean; removeBlockquotes?: boolean; removeQuotes?: boolean; target?: 'selection' | 'document'; scope?: { from: number; to: number } }) => boolean;\n        summarizeFormatting: () => { boldMarks: number; blockquotes: number; quoteChars: number; blocks: Array<{ from: number; to: number; text: string; boldMarks: number; blockquotes: number; quoteChars: number; type: string }> };\n        listCleanupTargets: () => Array<{ from: number; to: number; text: string; boldMarks: number; blockquotes: number; quoteChars: number; type: string }>;\n        getSelectionRange: () => { from: number; to: number };\n        replaceRange: (range: { from: number; to: number }, html: string) => void;\n        markAskAiRange: (range: { from: number; to: number }, taskId: string) => void;\n        clearAskAiMarks: (taskId?: string) => void;\n        findAskAiRange: (taskId: string) => { from: number; to: number } | null;\n        focus: () => void;\n    } | null>(null);\n\n    useEffect(() => {\n        setHtml(initialHtml);\n    }, [initialHtml]);\n\n    const effectiveKeyPoints = keyPointsProp.length ? keyPointsProp : (ctx?.keyPoints || []);\n    const effectiveBrandPoints = brandPointsProp.length ? brandPointsProp : (ctx?.brandExclusivePoints || []);\n    const effectiveCheckedPoints = checkedPointsProp.length ? checkedPointsProp : (ctx?.checkedPoints || []);\n    const effectiveScrapedImages = scrapedImagesProp.length ? scrapedImagesProp : (ctx?.scrapedImages || []);\n    const effectiveTargetAudience = targetAudience || (ctx?.targetAudience as TargetAudience) || 'zh-TW';\n    const effectiveVisualStyle = visualStyle || ctx?.visualStyle || '';\n    const effectiveProductBrief = productBrief || ctx?.productBrief || null;\n    const effectiveOutline = outlineSections.length ? outlineSections : (ctx?.outlineSections || []);\n    const { recordHtml, recordMeta, consumeDraft } = useEditorAutosave({ storageKey: 'ai_writer_editor_autosave_v1' });\n    const setCoveredPoints = useAnalysisStore(s => s.setCoveredPoints);\n\n    const {\n        metaTitle,\n        metaDescription,\n        urlSlug,\n        setMetaTitle,\n        setMetaDescription,\n        setUrlSlug,\n        isMetaLoading,\n        generateMeta,\n    } = useMetaGenerator({\n        editorRef: editorContainerRef,\n        tiptapApi,\n        targetAudience: effectiveTargetAudience,\n        context: {\n            keyPoints: effectiveKeyPoints,\n            brandExclusivePoints: effectiveBrandPoints,\n            productBrief: effectiveProductBrief || undefined,\n            visualStyle: effectiveVisualStyle,\n            outlineSections: effectiveOutline,\n        },\n        onAddCost,\n    });\n\n    const updateCounts = useCallback((plainText: string) => {\n        const cjkCount = (plainText.match(/[\\u4e00-\\u9fa5]/g) || []).length;\n        const nonCjkText = plainText.replace(/[\\u4e00-\\u9fa5]/g, ' ');\n        const englishWords = nonCjkText.trim().split(/\\s+/).filter(Boolean);\n        setCharCount(plainText.length);\n        setWordCount(cjkCount + englishWords.length);\n    }, []);\n\n    const handleInput = (nextHtml: string, plainText: string) => {\n        setHtml(nextHtml);\n        onChange?.(nextHtml);\n        ctx?.setContent?.(nextHtml);\n        updateCounts(plainText);\n        recordHtml(nextHtml);\n    };\n\n    const refreshCleanupSummary = useCallback(() => {\n        if (!tiptapApi) return;\n        const summary = tiptapApi.summarizeFormatting\n            ? tiptapApi.summarizeFormatting()\n            : { boldMarks: 0, blockquotes: 0, quoteChars: 0, blocks: [] };\n        setCleanupSummary(summary);\n        const blocks = tiptapApi.listCleanupTargets ? tiptapApi.listCleanupTargets() : [];\n        setCleanupBlocks(blocks);\n        setSelectedBlocks(new Set(blocks.map((b, idx) => `${b.from}-${b.to}-${idx}`)));\n    }, [tiptapApi]);\n\n    const handleOpenCleanupModal = useCallback(() => {\n        if (!tiptapApi) return;\n        refreshCleanupSummary();\n        setShowCleanupModal(true);\n    }, [refreshCleanupSummary, tiptapApi]);\n\n    const handleApplyCleanup = useCallback(() => {\n        if (!tiptapApi) return;\n        // Apply in reverse order to keep ranges stable.\n        const blocksToClean = cleanupBlocks\n            .map((b, idx) => ({ ...b, id: `${b.from}-${b.to}-${idx}` }))\n            .filter(b => selectedBlocks.has(b.id))\n            .sort((a, b) => b.from - a.from);\n\n        if (blocksToClean.length === 0) {\n            setShowCleanupModal(false);\n            return;\n        }\n\n        blocksToClean.forEach(block => {\n            tiptapApi.clearBold?.({\n                removeBold: true,\n                removeBlockquotes: true,\n                removeQuotes: true,\n                scope: { from: block.from, to: block.to },\n            });\n        });\n        const plain = tiptapApi.getPlainText();\n        const htmlValue = tiptapApi.getHtml();\n        setHtml(htmlValue);\n        onChange?.(htmlValue);\n        ctx?.setContent?.(htmlValue);\n        updateCounts(plain);\n        recordHtml(htmlValue);\n        setShowCleanupModal(false);\n    }, [cleanupBlocks, ctx, onChange, recordHtml, selectedBlocks, tiptapApi, updateCounts]);\n\n    const autoCheckKeyPoints = useCallback(() => {\n        if (hasAutoCheckedPoints) return;\n        if (!tiptapApi) return;\n\n        const plain = (tiptapApi.getPlainText ? tiptapApi.getPlainText() : '') || '';\n        if (!plain.trim()) return;\n\n        const normalized = plain.toLowerCase();\n        const candidates = [...effectiveBrandPoints, ...effectiveKeyPoints].filter(Boolean);\n        const matched = candidates.filter(pt => normalized.includes(pt.toLowerCase()));\n        if (matched.length === 0) return;\n\n        setCoveredPoints(prev => {\n            const next = new Set(prev);\n            matched.forEach(m => next.add(m));\n            return Array.from(next);\n        });\n        setHasAutoCheckedPoints(true);\n    }, [effectiveBrandPoints, effectiveKeyPoints, hasAutoCheckedPoints, setCoveredPoints, tiptapApi]);\n\n    const handleRefinePoint = useCallback(async (point: string) => {\n        if (!tiptapApi) {\n            alert('Editor not ready.');\n            return;\n        }\n        setRefiningPoint(point);\n        setIsAiRunning(true);\n        try {\n            const fullHtml = tiptapApi.getHtml();\n            const res = await smartInjectPoint(fullHtml, point, effectiveTargetAudience as TargetAudience);\n            const { originalSnippet, newSnippet } = res.data || {};\n\n            if (originalSnippet && newSnippet) {\n                let nextHtml = fullHtml;\n                if (fullHtml.includes(originalSnippet)) {\n                    nextHtml = fullHtml.replace(originalSnippet, newSnippet);\n                } else {\n                    const suggestionHtml = `\n                        <div style=\"border-left: 4px solid #8b5cf6; padding-left: 12px; margin: 16px 0; background: #f5f3ff; padding: 12px; border-radius: 4px;\">\n                            <p style=\"font-size: 10px; color: #8b5cf6; font-weight: bold; margin: 0 0 4px 0;\">✨ REFINED WITH: ${point}</p>\n                            ${newSnippet}\n                        </div>\n                    `;\n                    nextHtml = fullHtml + suggestionHtml;\n                }\n                tiptapApi.setHtml(nextHtml);\n                const plain = tiptapApi.getPlainText();\n                setHtml(nextHtml);\n                onChange?.(nextHtml);\n                ctx?.setContent?.(nextHtml);\n                updateCounts(plain);\n                recordHtml(nextHtml);\n                if (onAddCost) onAddCost(res.cost, res.usage);\n                (onTogglePoint || ctx?.onTogglePoint)?.(point);\n            } else {\n                alert('AI 無法找到適合的段落插入此重點。');\n            }\n        } catch (e) {\n            console.error('Refine failed', e);\n            alert('Refinement failed.');\n        } finally {\n            setRefiningPoint(null);\n            setIsAiRunning(false);\n        }\n    }, [ctx, effectiveTargetAudience, onAddCost, onChange, onTogglePoint, recordHtml, tiptapApi, updateCounts]);\n\n    const handleToolbarCommand = (command: string, value?: string) => {\n        if (!tiptapApi) return;\n        switch (command) {\n            case 'bold': return tiptapApi.toggleBold();\n            case 'italic': return tiptapApi.toggleItalic();\n            case 'underline': return tiptapApi.toggleUnderline?.();\n            case 'blockquote': return tiptapApi.toggleBlockquote();\n            case 'insertUnorderedList': return tiptapApi.toggleBulletList();\n            case 'insertOrderedList': return tiptapApi.toggleOrderedList();\n            case 'alignLeft': return tiptapApi.setTextAlign?.('left');\n            case 'alignCenter': return tiptapApi.setTextAlign?.('center');\n            case 'alignRight': return tiptapApi.setTextAlign?.('right');\n            case 'formatBlock':\n                if (value === '<h2>') return tiptapApi.toggleHeading(2);\n                if (value === '<h3>') return tiptapApi.toggleHeading(3);\n                if (value === '<blockquote>') return tiptapApi.toggleBlockquote();\n                return tiptapApi.toggleHeading(1);\n            case 'undo': return tiptapApi.undo();\n            case 'redo': return tiptapApi.redo();\n            case 'link': {\n                const href = window.prompt('Enter URL');\n                if (href) tiptapApi.setLink(href);\n                return;\n            }\n            case 'unlink': return tiptapApi.unsetLink();\n            default:\n                return;\n        }\n    };\n\n    const {\n        showImageModal,\n        setShowImageModal,\n        imagePrompt,\n        setImagePrompt,\n        isImageLoading,\n        isDownloadingImages,\n        imagePlans,\n        isPlanning,\n        isBatchProcessing,\n        generateImageFromPrompt,\n        downloadImages,\n        openImageModal,\n        autoPlanImages,\n        updatePlanPrompt,\n        injectImageIntoEditor,\n        generateSinglePlan,\n        handleBatchProcess,\n    } = useImageEditor({\n        editorRef: editorContainerRef,\n        tiptapApi,\n        imageContainerRef: editorContainerRef,\n        targetAudience: effectiveTargetAudience,\n        visualStyle: effectiveVisualStyle,\n        scrapedImages: effectiveScrapedImages,\n        onAddCost,\n        handleInput: () => {\n            const plain = tiptapApi?.getPlainText ? tiptapApi.getPlainText() : editorContainerRef.current?.innerText || '';\n            const htmlValue = tiptapApi?.getHtml ? tiptapApi.getHtml() : editorContainerRef.current?.innerHTML || '';\n            onChange?.(htmlValue);\n            ctx?.setContent?.(htmlValue);\n            updateCounts(plain);\n            recordHtml(htmlValue);\n        },\n        saveSelection: () => null,\n        restoreSelection: () => { },\n    });\n\n    const { runAskAiAction, handleAskAiInsert, clearAskAiState, lockAskAiRange, highlightAskAiTarget } = useAskAi({\n        tiptapApi,\n        targetAudience: effectiveTargetAudience as TargetAudience,\n        onAddCost,\n        setIsAiLoading: setIsAiRunning,\n        updateCountsFromText: (text) => updateCounts(text),\n        onChange: (nextHtml) => {\n            setHtml(nextHtml);\n            onChange?.(nextHtml);\n            ctx?.setContent?.(nextHtml);\n            recordHtml(nextHtml);\n        },\n    });\n\n    const uniqueCoveredCount = useMemo(() => {\n        return Array.from(new Set(effectiveCheckedPoints)).length;\n    }, [effectiveCheckedPoints]);\n    const totalPoints = effectiveKeyPoints.length + effectiveBrandPoints.length;\n\n    const autoCheckResetKey = useMemo(\n        () => `${initialHtml}||${effectiveKeyPoints.join('||')}||${effectiveBrandPoints.join('||')}`,\n        [initialHtml, effectiveBrandPoints, effectiveKeyPoints]\n    );\n\n    useEffect(() => {\n        if (!tiptapApi || hasRestoredDraftRef.current) return;\n        const draft = consumeDraft();\n        if (draft && draft.html) {\n            setHtml(draft.html);\n            tiptapApi.setHtml(draft.html);\n            updateCounts(tiptapApi.getPlainText());\n            if (draft.metaTitle) setMetaTitle(draft.metaTitle);\n            if (draft.metaDescription) setMetaDescription(draft.metaDescription);\n            if (draft.urlSlug) setUrlSlug(draft.urlSlug);\n            if (draft.articleTitle) {\n                onTitleChange?.(draft.articleTitle);\n                ctx?.setArticleTitle?.(draft.articleTitle);\n            }\n        }\n        hasRestoredDraftRef.current = true;\n    }, [consumeDraft, ctx, onTitleChange, tiptapApi, updateCounts, setMetaTitle, setMetaDescription, setUrlSlug]);\n\n    useEffect(() => {\n        recordMeta({\n            metaTitle,\n            metaDescription,\n            urlSlug,\n            articleTitle: articleTitle || ctx?.articleTitle || '',\n        });\n    }, [articleTitle, ctx?.articleTitle, metaDescription, metaTitle, recordMeta, urlSlug]);\n\n    useEffect(() => {\n        setHasAutoCheckedPoints(false);\n    }, [autoCheckResetKey]);\n\n    return (\n        <div className=\"rte-container flex flex-col h-full w-full min-h-0 bg-white overflow-hidden relative\">\n            <div className=\"rte-header flex flex-col gap-3 px-4 py-3 border-b border-gray-200 bg-white\">\n                <div className=\"mb-1\">\n                    <input\n                        value={articleTitle || ctx?.articleTitle || ''}\n                        onChange={(e) => {\n                            onTitleChange?.(e.target.value);\n                            ctx?.setArticleTitle?.(e.target.value);\n                        }}\n                        className=\"w-full text-2xl font-bold text-gray-800 placeholder-gray-300 border-none focus:ring-0 focus:outline-none bg-transparent px-0 py-1\"\n                        placeholder=\"Article Title...\"\n                    />\n                </div>\n                <div className=\"flex items-center gap-3 flex-wrap\">\n                    <div className=\"flex-1 min-w-[240px] flex items-center gap-2 bg-gray-100 rounded-full px-4 py-1.5 border border-transparent focus-within:border-blue-300 focus-within:bg-white focus-within:ring-2 focus-within:ring-blue-100 transition-all\">\n                        <span className=\"text-gray-400 flex items-center gap-1 select-none\">\n                            <span className=\"text-xs\">🔗</span>\n                            <span className=\"text-xs font-medium\">/</span>\n                        </span>\n                        <input\n                            value={urlSlug}\n                            onChange={(e) => setUrlSlug(e.target.value)}\n                            className=\"flex-1 bg-transparent border-none focus:outline-none text-xs font-mono text-gray-600 placeholder-gray-400\"\n                            placeholder=\"url-slug-goes-here\"\n                        />\n                    </div>\n                    {toolbarExtras && (\n                        <div className=\"flex items-center gap-2 ml-auto\">\n                            {toolbarExtras}\n                        </div>\n                    )}\n                </div>\n            </div>\n\n            <div className=\"rte-toolbar-wrapper\">\n                <EditorToolbar\n                    onCommand={handleToolbarCommand}\n                    onRemoveBold={handleOpenCleanupModal}\n                    onOpenImageModal={openImageModal}\n                    onDownloadAllImages={downloadImages}\n                    isDownloadingImages={isDownloadingImages}\n                    onToggleKeyPoints={() => {\n                        if (!showKeyPoints) autoCheckKeyPoints();\n                        setShowKeyPoints(!showKeyPoints);\n                        setShowVisualAssets(false);\n                    }}\n                    showKeyPoints={showKeyPoints}\n                    hasKeyPoints={totalPoints > 0}\n                    onToggleVisualAssets={() => { setShowVisualAssets(!showVisualAssets); setShowKeyPoints(false); }}\n                    showVisualAssets={showVisualAssets}\n                    onRebrand={() => { }}\n                    isRebranding={false}\n                    productName={effectiveProductBrief?.productName}\n                    onToggleMetaPanel={() => setShowMetaPanel((v) => !v)}\n                    showMetaPanel={showMetaPanel}\n                    onUndo={() => tiptapApi?.undo()}\n                    onRedo={() => tiptapApi?.redo()}\n                    askAiBadgeSlotRef={askAiBadgeContainerRef}\n                />\n            </div>\n\n            <div className=\"rte-workspace flex-1 flex flex-row min-h-0 overflow-hidden relative\">\n                <div className=\"rte-editor-column flex-1 flex flex-col min-h-0 relative group\">\n                    <div className=\"rte-scroll-area flex-1 min-h-0 overflow-y-auto\">\n                        <div\n                            className=\"rte-content-wrapper px-6 pb-6 pt-8 min-h-full flex flex-col cursor-text\"\n                            onClick={(e) => {\n                                if (tiptapApi) {\n                                    tiptapApi.focus();\n                                }\n                            }}\n                        >\n                            <TiptapAdapter\n                                initialHtml={html}\n                                onChange={(nextHtml, plain) => handleInput(nextHtml, plain)}\n                                onReady={(api) => {\n                                    setTiptapApi(api);\n                                    const plain = api.getPlainText ? api.getPlainText() : '';\n                                    updateCounts(plain);\n                                    recordHtml(api.getHtml());\n                                }}\n                                containerRef={editorContainerRef}\n                                className=\"min-h-[420px]\"\n                                placeholder=\"\"\n                                contentClassName=\"prose-lg max-w-none px-0 pb-6 [&>*:first-child]:mt-0\" contentStyle={useMemo(() => ({ fontSize: `${effectiveScale * 100}%`, lineHeight: '1.6' }), [effectiveScale])}\n                            />\n                        </div>\n                    </div>\n\n                    {/* Editor Overlays */}\n                    <AskAiSelection\n                        onRunAction={runAskAiAction}\n                        onInsert={(html, taskId) => {\n                            handleAskAiInsert(html, taskId);\n                        }}\n                        onLockSelectionRange={(taskId) => lockAskAiRange(taskId)}\n                        onHighlightTask={(taskId) => {\n                            // Ensure the saved task gets a persistent highlight in the editor.\n                            highlightAskAiTarget(taskId);\n                        }}\n                        badgeContainerRef={askAiBadgeContainerRef}\n                    />\n\n                    {showCleanupModal && (\n                        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm px-4\">\n                            <div className=\"w-full max-w-md bg-white rounded-xl shadow-2xl border border-gray-200 p-5 space-y-4\">\n                                <div className=\"flex items-start justify-between gap-3\">\n                                    <div>\n                                        <h3 className=\"text-lg font-bold text-gray-800\">清理粗體與引號</h3>\n                                        <p className=\"text-sm text-gray-500\">勾選需要清理的段落，會移除粗體、引用區塊與引號。</p>\n                                    </div>\n                                    <button\n                                        onClick={() => setShowCleanupModal(false)}\n                                        className=\"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors\"\n                                        aria-label=\"Close cleanup modal\"\n                                    >\n                                        <X className=\"w-4 h-4\" />\n                                    </button>\n                                </div>\n\n                                <div className=\"space-y-3\">\n                                    <div className=\"text-xs text-gray-600 bg-gray-50 border border-gray-100 rounded-md p-3 leading-relaxed\">\n                                        勾選要清理的段落即可，系統會同時清除粗體、引用區塊與引號字元。掃描結果：粗體 {cleanupSummary.boldMarks}、引用 {cleanupSummary.blockquotes}、引號 {cleanupSummary.quoteChars}。\n                                    </div>\n\n                                    <div className=\"space-y-2\">\n                                        <div className=\"text-xs font-semibold text-gray-700\">選擇要清理的段落</div>\n                                        <div className=\"max-h-48 overflow-y-auto custom-scrollbar space-y-1\">\n                                            {cleanupBlocks.map((block, idx) => {\n                                                const id = `${block.from}-${block.to}-${idx}`;\n                                                const checked = selectedBlocks.has(id);\n                                                return (\n                                                    <label key={id} className=\"flex items-start gap-3 p-3 rounded-lg border border-gray-100 hover:border-gray-200 transition-colors\">\n                                                        <input\n                                                            type=\"checkbox\"\n                                                            checked={checked}\n                                                            onChange={(e) => {\n                                                                setSelectedBlocks(prev => {\n                                                                    const next = new Set(prev);\n                                                                    if (e.target.checked) next.add(id); else next.delete(id);\n                                                                    return next;\n                                                                });\n                                                            }}\n                                                            className=\"mt-1 accent-blue-600\"\n                                                        />\n                                                        <div className=\"flex-1 min-w-0 space-y-1\">\n                                                            <div className=\"text-sm font-semibold text-gray-800 flex items-center gap-2\">\n                                                                <span className=\"px-2 py-0.5 text-[10px] rounded-full bg-gray-100 text-gray-600 border border-gray-200\">\n                                                                    {block.type}\n                                                                </span>\n                                                                <span className=\"text-xs text-gray-500\">\n                                                                    粗體 {block.boldMarks} · 引用 {block.blockquotes} · 引號 {block.quoteChars}\n                                                                </span>\n                                                            </div>\n                                                            <div className=\"text-xs text-gray-700 whitespace-pre-wrap break-words leading-relaxed\">{block.text || '（空白段落）'}</div>\n                                                        </div>\n                                                    </label>\n                                                );\n                                            })}\n                                            {cleanupBlocks.length === 0 && (\n                                                <div className=\"text-xs text-gray-400 p-2 bg-gray-50 border border-dashed border-gray-200 rounded\">\n                                                    沒有找到包含粗體或引號的段落。\n                                                </div>\n                                            )}\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <div className=\"flex items-center justify-between text-xs text-gray-500\">\n                                    <button\n                                        type=\"button\"\n                                        onClick={refreshCleanupSummary}\n                                        className=\"text-blue-600 hover:text-blue-700 font-semibold\"\n                                    >\n                                        重新掃描\n                                    </button>\n                                    <div className=\"flex items-center gap-2\">\n                                        <button\n                                            type=\"button\"\n                                            onClick={() => setShowCleanupModal(false)}\n                                            className=\"px-3 py-2 rounded-md border border-gray-200 text-gray-700 hover:bg-gray-50 transition-colors\"\n                                        >\n                                            取消\n                                        </button>\n                                        <button\n                                            type=\"button\"\n                                            onClick={handleApplyCleanup}\n                                            className=\"px-3 py-2 rounded-md text-white font-semibold transition-colors bg-blue-600 hover:bg-blue-700\"\n                                        >\n                                            套用清理\n                                        </button>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    )}\n\n                    {showMetaPanel && (\n                        <MetaPanel\n                            metaTitle={metaTitle}\n                            metaDescription={metaDescription}\n                            urlSlug={urlSlug}\n                            isMetaLoading={isMetaLoading}\n                            onGenerateMeta={generateMeta}\n                            onClose={() => setShowMetaPanel(false)}\n                            onMetaTitleChange={setMetaTitle}\n                            onMetaDescriptionChange={setMetaDescription}\n                            onUrlSlugChange={setUrlSlug}\n                        />\n                    )}\n\n                    <ImageGeneratorModal\n                        show={showImageModal}\n                        imagePrompt={imagePrompt}\n                        onPromptChange={setImagePrompt}\n                        onSubmit={() => generateImageFromPrompt(imagePrompt)}\n                        isLoading={isImageLoading}\n                        onClose={() => setShowImageModal(false)}\n                    />\n                </div>\n\n                {/* Sidebars */}\n                {showKeyPoints && (\n                    <KeyPointsPanel\n                        brandExclusivePoints={effectiveBrandPoints}\n                        keyPoints={effectiveKeyPoints}\n                        checkedPoints={effectiveCheckedPoints}\n                        refiningPoint={refiningPoint}\n                        onTogglePoint={onTogglePoint || ctx?.onTogglePoint}\n                        onRefinePoint={handleRefinePoint}\n                        useTiptap\n                        isTiptapReady={Boolean(tiptapApi)}\n                        uniqueCoveredCount={uniqueCoveredCount}\n                        totalPoints={totalPoints}\n                        targetAudience={effectiveTargetAudience}\n                    />\n                )}\n\n                {showVisualAssets && (\n                    <VisualAssetsPanel\n                        scrapedImages={effectiveScrapedImages}\n                        onToggleImage={onRemoveScrapedImage || ctx?.onRemoveScrapedImage || (() => { })}\n                        imagePlans={imagePlans as ImageAssetPlan[]}\n                        isPlanning={isPlanning}\n                        isBatchProcessing={isBatchProcessing}\n                        onBatchProcess={handleBatchProcess}\n                        onAutoPlan={autoPlanImages}\n                        onGenerateSinglePlan={generateSinglePlan}\n                        onUpdatePlanPrompt={updatePlanPrompt}\n                        onInjectImage={injectImageIntoEditor}\n                        useTiptap\n                        isTiptapReady={Boolean(tiptapApi)}\n                    />\n                )}\n            </div>\n\n            {isAiRunning && (\n                <div className=\"pointer-events-none fixed bottom-4 right-4 z-40\">\n                    <div className=\"flex items-center gap-2 px-4 py-2 bg-white/90 border border-gray-200 rounded-lg shadow-sm text-sm text-gray-700\">\n                        <Loader2 className=\"w-4 h-4 animate-spin text-blue-600\" />\n                        <span>AI is working...</span>\n                    </div>\n                </div>\n            )}\n\n            <div className=\"rte-footer px-4 py-2 bg-gray-50/95 backdrop-blur border-t border-gray-200 text-[10px] text-gray-500 font-mono flex items-center justify-end gap-4 select-none sticky bottom-0 z-10\">\n                <span>{wordCount} words</span>\n                <span>{charCount} chars</span>\n            </div>\n        </div>\n    );\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3809, "column": 0}, "map": {"version":3,"sources":["file:///Users/rose/Documents/this_month/write-content/best-ai-text-writer.com/src/components/StreamingModal.tsx"],"sourcesContent":["import React, { useEffect, useRef } from 'react';\nimport { Loader2, Sparkles, FileText, CheckCircle2 } from 'lucide-react';\nimport { GenerationStep } from '../types';\nimport { marked } from 'marked';\n\ninterface StreamingModalProps {\n    isOpen: boolean;\n    content: string;\n    step: GenerationStep;\n    onClose?: () => void; // Optional, mostly for dev or forced close\n}\n\nexport const StreamingModal: React.FC<StreamingModalProps> = ({\n    isOpen,\n    content,\n    step,\n}) => {\n    const scrollRef = useRef<HTMLDivElement>(null);\n\n    // Auto-scroll to bottom\n    useEffect(() => {\n        if (scrollRef.current) {\n            scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\n        }\n    }, [content]);\n\n    if (!isOpen) return null;\n\n    const getStepLabel = (s: GenerationStep) => {\n        switch (s) {\n            case 'writing_content': return 'AI 正在撰寫文章...';\n            case 'refining_headings': return '正在優化標題 (H2/H3 Swap)...';\n            case 'localizing_hk': return '正在套用香港市場用語...';\n            case 'finalizing': return '正在完成最後修飾...';\n            default: return 'AI 正在思考...';\n        }\n    };\n\n    const isRefining = step === 'refining_headings';\n\n    return (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4\">\n            <div className=\"bg-white w-full max-w-4xl h-[80vh] rounded-2xl shadow-2xl flex flex-col overflow-hidden border border-gray-200 animate-in fade-in zoom-in-95 duration-300\">\n\n                {/* Header */}\n                <div className=\"px-6 py-4 border-b border-gray-100 bg-gray-50/80 flex items-center justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                        <div className={`w-10 h-10 rounded-full flex items-center justify-center ${isRefining ? 'bg-purple-100' : 'bg-blue-100'}`}>\n                            {isRefining ? (\n                                <Sparkles className=\"w-5 h-5 text-purple-600 animate-pulse\" />\n                            ) : (\n                                <Loader2 className=\"w-5 h-5 text-blue-600 animate-spin\" />\n                            )}\n                        </div>\n                        <div>\n                            <h3 className=\"text-lg font-bold text-gray-800 flex items-center gap-2\">\n                                {getStepLabel(step)}\n                            </h3>\n                            <p className=\"text-xs text-gray-500\">請稍候，文章生成中...</p>\n                        </div>\n                    </div>\n\n                    {/* Progress Steps (Visual only) */}\n                    <div className=\"flex items-center gap-2 text-xs font-medium text-gray-400\">\n                        <span className={`flex items-center gap-1 ${step === 'writing_content' ? 'text-blue-600' : 'text-gray-600'}`}>\n                            <FileText className=\"w-3 h-3\" /> 撰寫\n                        </span>\n                        <span className=\"w-4 h-px bg-gray-300\" />\n                        <span className={`flex items-center gap-1 ${step === 'refining_headings' ? 'text-purple-600' : (step === 'finalizing' ? 'text-green-600' : '')}`}>\n                            <Sparkles className=\"w-3 h-3\" /> 優化\n                        </span>\n                        <span className=\"w-4 h-px bg-gray-300\" />\n                        <span className={`flex items-center gap-1 ${step === 'finalizing' ? 'text-green-600' : ''}`}>\n                            <CheckCircle2 className=\"w-3 h-3\" /> 完成\n                        </span>\n                    </div>\n                </div>\n\n                {/* Content Area */}\n                <div className=\"flex-1 overflow-hidden relative bg-white\">\n                    <div\n                        ref={scrollRef}\n                        className=\"absolute inset-0 overflow-y-auto p-8 custom-scrollbar scroll-smooth\"\n                    >\n                        <div className=\"prose prose-lg max-w-none prose-headings:font-bold prose-h1:text-3xl prose-h2:text-2xl prose-p:text-gray-600 prose-p:leading-relaxed\">\n                            <div dangerouslySetInnerHTML={{ __html: marked.parse(content || '') as string }} />\n\n                            {/* Cursor Effect */}\n                            <span className=\"inline-block w-2 h-5 bg-blue-500 ml-1 animate-pulse align-middle\" />\n                        </div>\n                    </div>\n                </div>\n\n                {/* Footer */}\n                <div className=\"px-6 py-3 border-t border-gray-100 bg-gray-50 text-center text-xs text-gray-400\">\n                    AI 生成內容僅供參考，請務必人工審閱。\n                </div>\n            </div>\n        </div>\n    );\n};\n"],"names":[],"mappings":";;;;;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;;;;;AASO,MAAM,iBAAgD,CAAC,EAC1D,MAAM,EACN,OAAO,EACP,IAAI,EACP;IACG,MAAM,YAAY,IAAA,+MAAM,EAAiB;IAEzC,wBAAwB;IACxB,IAAA,kNAAS,EAAC;QACN,IAAI,UAAU,OAAO,EAAE;YACnB,UAAU,OAAO,CAAC,SAAS,GAAG,UAAU,OAAO,CAAC,YAAY;QAChE;IACJ,GAAG;QAAC;KAAQ;IAEZ,IAAI,CAAC,QAAQ,OAAO;IAEpB,MAAM,eAAe,CAAC;QAClB,OAAQ;YACJ,KAAK;gBAAmB,OAAO;YAC/B,KAAK;gBAAqB,OAAO;YACjC,KAAK;gBAAiB,OAAO;YAC7B,KAAK;gBAAc,OAAO;YAC1B;gBAAS,OAAO;QACpB;IACJ;IAEA,MAAM,aAAa,SAAS;IAE5B,qBACI,8OAAC;QAAI,WAAU;kBACX,cAAA,8OAAC;YAAI,WAAU;;8BAGX,8OAAC;oBAAI,WAAU;;sCACX,8OAAC;4BAAI,WAAU;;8CACX,8OAAC;oCAAI,WAAW,CAAC,wDAAwD,EAAE,aAAa,kBAAkB,eAAe;8CACpH,2BACG,8OAAC,sNAAQ;wCAAC,WAAU;;;;;iGAEpB,8OAAC,4NAAO;wCAAC,WAAU;;;;;;;;;;;8CAG3B,8OAAC;;sDACG,8OAAC;4CAAG,WAAU;sDACT,aAAa;;;;;;sDAElB,8OAAC;4CAAE,WAAU;sDAAwB;;;;;;;;;;;;;;;;;;sCAK7C,8OAAC;4BAAI,WAAU;;8CACX,8OAAC;oCAAK,WAAW,CAAC,wBAAwB,EAAE,SAAS,oBAAoB,kBAAkB,iBAAiB;;sDACxG,8OAAC,0NAAQ;4CAAC,WAAU;;;;;;wCAAY;;;;;;;8CAEpC,8OAAC;oCAAK,WAAU;;;;;;8CAChB,8OAAC;oCAAK,WAAW,CAAC,wBAAwB,EAAE,SAAS,sBAAsB,oBAAqB,SAAS,eAAe,mBAAmB,IAAK;;sDAC5I,8OAAC,sNAAQ;4CAAC,WAAU;;;;;;wCAAY;;;;;;;8CAEpC,8OAAC;oCAAK,WAAU;;;;;;8CAChB,8OAAC;oCAAK,WAAW,CAAC,wBAAwB,EAAE,SAAS,eAAe,mBAAmB,IAAI;;sDACvF,8OAAC,qOAAY;4CAAC,WAAU;;;;;;wCAAY;;;;;;;;;;;;;;;;;;;8BAMhD,8OAAC;oBAAI,WAAU;8BACX,cAAA,8OAAC;wBACG,KAAK;wBACL,WAAU;kCAEV,cAAA,8OAAC;4BAAI,WAAU;;8CACX,8OAAC;oCAAI,yBAAyB;wCAAE,QAAQ,wJAAM,CAAC,KAAK,CAAC,WAAW;oCAAc;;;;;;8CAG9E,8OAAC;oCAAK,WAAU;;;;;;;;;;;;;;;;;;;;;;8BAM5B,8OAAC;oBAAI,WAAU;8BAAkF;;;;;;;;;;;;;;;;;AAMjH"}},
    {"offset": {"line": 4055, "column": 0}, "map": {"version":3,"sources":["file:///Users/rose/Documents/this_month/write-content/best-ai-text-writer.com/src/components/RegionGroundingModal.tsx"],"sourcesContent":["import React, { useMemo } from 'react';\nimport { X, Globe, CheckCircle2, AlertTriangle, ArrowRight } from 'lucide-react';\nimport { useAnalysisStore } from '../store/useAnalysisStore';\nimport { useGenerationStore } from '../store/useGenerationStore';\n\ninterface RegionGroundingModalProps {\n    onApply: (selectedIssues: { original: string; regionEquivalent: string }[]) => void;\n    onSkip: () => void;\n}\n\nexport const RegionGroundingModal: React.FC<RegionGroundingModalProps> = ({\n    onApply,\n    onSkip,\n}) => {\n    const {\n        pendingGroundingResult,\n        showGroundingModal,\n        setShowGroundingModal,\n        toggleGroundingIssueSelection,\n    } = useAnalysisStore();\n\n    const issues = pendingGroundingResult?.issues || [];\n    const regionLabel = pendingGroundingResult?.regionLabel || '目標地區';\n\n    const selectedCount = useMemo(\n        () => issues.filter(i => i.selected).length,\n        [issues]\n    );\n\n    const handleApply = () => {\n        const selected = issues\n            .filter(i => i.selected)\n            .map(i => ({ original: i.original, regionEquivalent: i.regionEquivalent }));\n        onApply(selected);\n        setShowGroundingModal(false);\n    };\n\n    const handleSkip = () => {\n        onSkip();\n        setShowGroundingModal(false);\n    };\n\n    const handleSelectAll = () => {\n        issues.forEach((_, idx) => {\n            if (!issues[idx].selected) {\n                toggleGroundingIssueSelection(idx);\n            }\n        });\n    };\n\n    const handleDeselectAll = () => {\n        issues.forEach((_, idx) => {\n            if (issues[idx].selected) {\n                toggleGroundingIssueSelection(idx);\n            }\n        });\n    };\n\n    if (!showGroundingModal || !pendingGroundingResult || issues.length === 0) {\n        return null;\n    }\n\n    return (\n        <div className=\"fixed inset-0 z-[80] flex items-center justify-center p-4\">\n            <div className=\"absolute inset-0 bg-black/40 backdrop-blur-sm\" onClick={handleSkip} />\n            <div className=\"relative bg-white w-full max-w-2xl max-h-[80vh] rounded-2xl shadow-2xl border border-gray-200 flex flex-col overflow-hidden\">\n                {/* Header */}\n                <div className=\"px-6 py-4 border-b border-gray-100 bg-gradient-to-r from-amber-50/80 to-white flex items-center justify-between gap-3\">\n                    <div className=\"flex items-center gap-3\">\n                        <div className=\"w-10 h-10 rounded-xl bg-amber-600 text-white flex items-center justify-center shadow-lg shadow-amber-200\">\n                            <Globe className=\"w-5 h-5\" />\n                        </div>\n                        <div className=\"flex flex-col\">\n                            <h3 className=\"text-lg font-bold text-gray-900 leading-tight\">\n                                {regionLabel}市場本地化確認\n                            </h3>\n                            <p className=\"text-xs text-gray-500\">\n                                偵測到 {issues.length} 個非{regionLabel}實體，請選擇要替換的項目\n                            </p>\n                        </div>\n                    </div>\n                    <button\n                        onClick={handleSkip}\n                        className=\"p-2 rounded-lg hover:bg-gray-100 text-gray-500\"\n                        aria-label=\"Close modal\"\n                    >\n                        <X className=\"w-5 h-5\" />\n                    </button>\n                </div>\n\n                {/* Content */}\n                <div className=\"flex-1 overflow-y-auto p-4 space-y-3\">\n                    <div className=\"flex items-center justify-between mb-2\">\n                        <span className=\"text-xs text-gray-500\">\n                            已選擇 {selectedCount} / {issues.length} 項\n                        </span>\n                        <div className=\"flex gap-2\">\n                            <button\n                                onClick={handleSelectAll}\n                                className=\"text-xs text-blue-600 hover:underline\"\n                            >\n                                全選\n                            </button>\n                            <button\n                                onClick={handleDeselectAll}\n                                className=\"text-xs text-gray-500 hover:underline\"\n                            >\n                                取消全選\n                            </button>\n                        </div>\n                    </div>\n\n                    {issues.map((issue, idx) => (\n                        <div\n                            key={idx}\n                            className={`p-4 rounded-xl border transition-all cursor-pointer ${issue.selected\n                                    ? 'border-amber-200 bg-amber-50/60 shadow-sm'\n                                    : 'border-gray-100 bg-white hover:border-gray-200'\n                                }`}\n                            onClick={() => toggleGroundingIssueSelection(idx)}\n                        >\n                            <div className=\"flex items-start gap-3\">\n                                <input\n                                    type=\"checkbox\"\n                                    checked={issue.selected}\n                                    onChange={() => toggleGroundingIssueSelection(idx)}\n                                    onClick={(e) => e.stopPropagation()}\n                                    className=\"mt-1 h-4 w-4 rounded border-gray-300 text-amber-600 focus:ring-amber-500\"\n                                />\n                                <div className=\"flex-1 min-w-0\">\n                                    <div className=\"flex items-center gap-2 flex-wrap\">\n                                        <span className=\"text-xs px-2 py-0.5 rounded-full bg-gray-100 text-gray-600 uppercase\">\n                                            {issue.type}\n                                        </span>\n                                        <span className=\"text-xs text-gray-400\">\n                                            信心度: {Math.round(issue.confidence * 100)}%\n                                        </span>\n                                    </div>\n                                    <div className=\"mt-2 flex items-center gap-2 flex-wrap\">\n                                        <span className=\"text-sm font-medium text-rose-700 line-through\">\n                                            {issue.original}\n                                        </span>\n                                        <ArrowRight className=\"w-4 h-4 text-gray-400 flex-shrink-0\" />\n                                        <span className=\"text-sm font-semibold text-emerald-700\">\n                                            {issue.regionEquivalent}\n                                        </span>\n                                    </div>\n                                    {issue.context && (\n                                        <p className=\"mt-1 text-xs text-gray-500 leading-relaxed\">\n                                            {issue.context}\n                                        </p>\n                                    )}\n                                </div>\n                            </div>\n                        </div>\n                    ))}\n                </div>\n\n                {/* Footer */}\n                <div className=\"px-6 py-4 border-t border-gray-100 bg-gray-50/70 flex items-center justify-between gap-3\">\n                    <div className=\"flex items-center gap-2 text-xs text-gray-500\">\n                        <AlertTriangle className=\"w-4 h-4 text-amber-500\" />\n                        未選擇的項目將保留原文\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                        <button\n                            onClick={handleSkip}\n                            className=\"px-4 py-2 text-sm font-semibold text-gray-700 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition\"\n                        >\n                            跳過 (保留原文)\n                        </button>\n                        <button\n                            onClick={handleApply}\n                            disabled={selectedCount === 0}\n                            className=\"px-4 py-2 text-sm font-semibold text-white bg-gradient-to-r from-amber-600 to-orange-600 rounded-lg shadow-sm hover:brightness-110 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\n                        >\n                            <CheckCircle2 className=\"w-4 h-4\" />\n                            套用 {selectedCount} 項替換\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n"],"names":[],"mappings":";;;;;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;AAQO,MAAM,uBAA4D,CAAC,EACtE,OAAO,EACP,MAAM,EACT;IACG,MAAM,EACF,sBAAsB,EACtB,kBAAkB,EAClB,qBAAqB,EACrB,6BAA6B,EAChC,GAAG,IAAA,oJAAgB;IAEpB,MAAM,SAAS,wBAAwB,UAAU,EAAE;IACnD,MAAM,cAAc,wBAAwB,eAAe;IAE3D,MAAM,gBAAgB,IAAA,gNAAO,EACzB,IAAM,OAAO,MAAM,CAAC,CAAA,IAAK,EAAE,QAAQ,EAAE,MAAM,EAC3C;QAAC;KAAO;IAGZ,MAAM,cAAc;QAChB,MAAM,WAAW,OACZ,MAAM,CAAC,CAAA,IAAK,EAAE,QAAQ,EACtB,GAAG,CAAC,CAAA,IAAK,CAAC;gBAAE,UAAU,EAAE,QAAQ;gBAAE,kBAAkB,EAAE,gBAAgB;YAAC,CAAC;QAC7E,QAAQ;QACR,sBAAsB;IAC1B;IAEA,MAAM,aAAa;QACf;QACA,sBAAsB;IAC1B;IAEA,MAAM,kBAAkB;QACpB,OAAO,OAAO,CAAC,CAAC,GAAG;YACf,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE;gBACvB,8BAA8B;YAClC;QACJ;IACJ;IAEA,MAAM,oBAAoB;QACtB,OAAO,OAAO,CAAC,CAAC,GAAG;YACf,IAAI,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE;gBACtB,8BAA8B;YAClC;QACJ;IACJ;IAEA,IAAI,CAAC,sBAAsB,CAAC,0BAA0B,OAAO,MAAM,KAAK,GAAG;QACvE,OAAO;IACX;IAEA,qBACI,8OAAC;QAAI,WAAU;;0BACX,8OAAC;gBAAI,WAAU;gBAAgD,SAAS;;;;;;0BACxE,8OAAC;gBAAI,WAAU;;kCAEX,8OAAC;wBAAI,WAAU;;0CACX,8OAAC;gCAAI,WAAU;;kDACX,8OAAC;wCAAI,WAAU;kDACX,cAAA,8OAAC,6MAAK;4CAAC,WAAU;;;;;;;;;;;kDAErB,8OAAC;wCAAI,WAAU;;0DACX,8OAAC;gDAAG,WAAU;;oDACT;oDAAY;;;;;;;0DAEjB,8OAAC;gDAAE,WAAU;;oDAAwB;oDAC5B,OAAO,MAAM;oDAAC;oDAAI;oDAAY;;;;;;;;;;;;;;;;;;;0CAI/C,8OAAC;gCACG,SAAS;gCACT,WAAU;gCACV,cAAW;0CAEX,cAAA,8OAAC,iMAAC;oCAAC,WAAU;;;;;;;;;;;;;;;;;kCAKrB,8OAAC;wBAAI,WAAU;;0CACX,8OAAC;gCAAI,WAAU;;kDACX,8OAAC;wCAAK,WAAU;;4CAAwB;4CAC/B;4CAAc;4CAAI,OAAO,MAAM;4CAAC;;;;;;;kDAEzC,8OAAC;wCAAI,WAAU;;0DACX,8OAAC;gDACG,SAAS;gDACT,WAAU;0DACb;;;;;;0DAGD,8OAAC;gDACG,SAAS;gDACT,WAAU;0DACb;;;;;;;;;;;;;;;;;;4BAMR,OAAO,GAAG,CAAC,CAAC,OAAO,oBAChB,8OAAC;oCAEG,WAAW,CAAC,oDAAoD,EAAE,MAAM,QAAQ,GACtE,8CACA,kDACJ;oCACN,SAAS,IAAM,8BAA8B;8CAE7C,cAAA,8OAAC;wCAAI,WAAU;;0DACX,8OAAC;gDACG,MAAK;gDACL,SAAS,MAAM,QAAQ;gDACvB,UAAU,IAAM,8BAA8B;gDAC9C,SAAS,CAAC,IAAM,EAAE,eAAe;gDACjC,WAAU;;;;;;0DAEd,8OAAC;gDAAI,WAAU;;kEACX,8OAAC;wDAAI,WAAU;;0EACX,8OAAC;gEAAK,WAAU;0EACX,MAAM,IAAI;;;;;;0EAEf,8OAAC;gEAAK,WAAU;;oEAAwB;oEAC9B,KAAK,KAAK,CAAC,MAAM,UAAU,GAAG;oEAAK;;;;;;;;;;;;;kEAGjD,8OAAC;wDAAI,WAAU;;0EACX,8OAAC;gEAAK,WAAU;0EACX,MAAM,QAAQ;;;;;;0EAEnB,8OAAC,gOAAU;gEAAC,WAAU;;;;;;0EACtB,8OAAC;gEAAK,WAAU;0EACX,MAAM,gBAAgB;;;;;;;;;;;;oDAG9B,MAAM,OAAO,kBACV,8OAAC;wDAAE,WAAU;kEACR,MAAM,OAAO;;;;;;;;;;;;;;;;;;mCAnCzB;;;;;;;;;;;kCA6CjB,8OAAC;wBAAI,WAAU;;0CACX,8OAAC;gCAAI,WAAU;;kDACX,8OAAC,yOAAa;wCAAC,WAAU;;;;;;oCAA2B;;;;;;;0CAGxD,8OAAC;gCAAI,WAAU;;kDACX,8OAAC;wCACG,SAAS;wCACT,WAAU;kDACb;;;;;;kDAGD,8OAAC;wCACG,SAAS;wCACT,UAAU,kBAAkB;wCAC5B,WAAU;;0DAEV,8OAAC,qOAAY;gDAAC,WAAU;;;;;;4CAAY;4CAChC;4CAAc;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAO9C"}},
    {"offset": {"line": 4450, "column": 0}, "map": {"version":3,"sources":["file:///Users/rose/Documents/this_month/write-content/best-ai-text-writer.com/src/components/HeadingOptimizerModal.tsx"],"sourcesContent":["\nimport React, { useState, useEffect } from 'react';\nimport { X, Sparkles, Check, ChevronDown, ChevronRight, Wand2, Loader2, RefreshCw } from 'lucide-react';\nimport { useGenerationStore } from '../store/useGenerationStore';\nimport { useAnalysisStore } from '../store/useAnalysisStore';\nimport { refineHeadings } from '../services/generation/headingRefinerService';\nimport { cleanHeadingText } from '../utils/textUtils';\nimport { HeadingResult } from '../types';\n\ninterface HeadingOptimizerModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n    onApply: (newContent: string) => void;\n}\n\nexport const HeadingOptimizerModal: React.FC<HeadingOptimizerModalProps> = ({\n    isOpen,\n    onClose,\n    onApply\n}) => {\n    const { content } = useGenerationStore();\n    const { targetAudience, articleTitle, headingOptimizations, setHeadingOptimizations } = useAnalysisStore();\n\n    const [isAnalyzing, setIsAnalyzing] = useState(false);\n    const [selectedOptions, setSelectedOptions] = useState<Record<number, string>>({}); // index -> selected text\n    const [expandedIndex, setExpandedIndex] = useState<number | null>(0);\n\n    // Parse current headings from content\n    const extractHeadingsFromContent = (htmlContent: string) => {\n        const parser = new DOMParser();\n        const doc = parser.parseFromString(htmlContent, 'text/html');\n        // Look for h2s. If not proper HTML, fallback to regex for markdown\n        let h2s = Array.from(doc.querySelectorAll('h2')).map(h => h.textContent?.trim() || '');\n\n        if (h2s.length === 0) {\n            // Try regex for markdown \"## Title\"\n            const matches = htmlContent.match(/^##\\s+(.+)$/gm);\n            if (matches) {\n                h2s = matches.map(m => m.replace(/^##\\s+/, '').trim());\n            }\n        }\n        return h2s.filter(Boolean);\n    };\n\n    const handleAnalyze = async () => {\n        setIsAnalyzing(true);\n        const currentHeadings = extractHeadingsFromContent(content);\n\n        if (currentHeadings.length === 0) {\n            alert(\"No H2 headings found in the content to optimize.\");\n            setIsAnalyzing(false);\n            return;\n        }\n\n        try {\n            const res = await refineHeadings(\n                articleTitle || 'Article',\n                currentHeadings,\n                targetAudience\n            );\n\n            if (res.data) {\n                // Map the result to our store format\n                const newOptimizations = res.data.map((item: any, idx: number) => ({\n                    h2_before: currentHeadings[idx] || item.h2_before,\n                    h2_after: item.h2_after, // Default suggestion\n                    h2_reason: item.h2_reason,\n                    h2_options: item.h2_options,\n                    h3: item.h3\n                }));\n\n                setHeadingOptimizations(newOptimizations);\n\n                // Pre-select the AI's best choice (h2_after)\n                const defaults: Record<number, string> = {};\n                newOptimizations.forEach((opt: any, i: number) => {\n                    defaults[i] = opt.h2_after;\n                });\n                setSelectedOptions(defaults);\n            }\n        } catch (error) {\n            console.error(\"Failed to optimize headings\", error);\n            alert(\"Failed to optimize headings. Please try again.\");\n        } finally {\n            setIsAnalyzing(false);\n        }\n    };\n\n    const handleApply = () => {\n        let newContent = content;\n\n        // Naive replacement strategy:\n        // We iterate through optimizations and replace the \"h2_before\" (or matched heading) with \"selected text\"\n        // To avoid replacing the wrong thing if headings are duplicates, we should be careful.\n        // For now, we'll try a sequential replacement if we can match context, or just global replace if unique.\n\n        // A better approach for HTML content:\n        // Parse -> Replace nodes -> Serialize\n\n        // Let's assume content is HTML-ish (checking RichTextEditor usage)\n        // If it's pure markdown, we use regex.\n\n        headingOptimizations.forEach((opt, idx) => {\n            const selectedText = selectedOptions[idx];\n            if (!selectedText || selectedText === opt.h2_before) return;\n\n            // Escape special regex chars in original heading\n            const escapedOriginal = opt.h2_before.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n\n            // Try to match H2 tags first\n            const regexHtml = new RegExp(`(<h2[^>]*>)\\\\s*${escapedOriginal}\\\\s*(<\\\\/h2>)`, 'i');\n            if (regexHtml.test(newContent)) {\n                newContent = newContent.replace(regexHtml, `$1${selectedText}$2`);\n                return;\n            }\n\n            // Fallback to markdown style \"## Title\"\n            const regexMd = new RegExp(`(##\\\\s+)${escapedOriginal}(\\\\n|$)`, 'i');\n            if (regexMd.test(newContent)) {\n                newContent = newContent.replace(regexMd, `$1${selectedText}$2`);\n                return;\n            }\n\n            // Last resort: simple string replace (risky if heading words appear in text)\n            // Ideally ensure it's a heading line\n        });\n\n        onApply(newContent);\n        onClose();\n    };\n\n    // Initialize/Reset when opening\n    useEffect(() => {\n        if (isOpen && headingOptimizations.length === 0 && !isAnalyzing) {\n            // Optionally auto-analyze if missing?\n            // Let's let the user click \"Analyze\" to be explicit, showing the \"Empty State\" first.\n        } else if (isOpen && headingOptimizations.length > 0) {\n            // Restore selections or default to current optimized state\n            const defaults: Record<number, string> = {};\n            headingOptimizations.forEach((opt, i) => {\n                defaults[i] = selectedOptions[i] || opt.h2_after;\n            });\n            setSelectedOptions(defaults);\n        }\n    }, [isOpen]);\n\n    if (!isOpen) return null;\n\n    return (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-[2px] p-4 animate-in fade-in duration-200\">\n            <div className=\"bg-white dark:bg-gray-800 w-full max-w-4xl max-h-[85vh] rounded-xl shadow-2xl flex flex-col overflow-hidden border border-gray-200 dark:border-gray-700\">\n\n                {/* Header */}\n                <div className=\"flex items-center justify-between px-6 py-4 border-b border-gray-100 dark:border-gray-700 bg-gradient-to-r from-blue-50/50 to-purple-50/50 dark:from-gray-800 dark:to-gray-800\">\n                    <div className=\"flex items-center gap-2\">\n                        <div className=\"p-2 bg-blue-100 dark:bg-blue-900/40 rounded-lg text-blue-600 dark:text-blue-400\">\n                            <Sparkles className=\"w-5 h-5\" />\n                        </div>\n                        <div>\n                            <h2 className=\"text-lg font-bold text-gray-800 dark:text-gray-100\">Heading Optimizer</h2>\n                            <p className=\"text-xs text-gray-500 dark:text-gray-400\">AI-powered refinement for high-impact H2s</p>\n                        </div>\n                    </div>\n                    <button onClick={onClose} className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors\">\n                        <X className=\"w-5 h-5 text-gray-500\" />\n                    </button>\n                </div>\n\n                {/* Content */}\n                <div className=\"flex-1 overflow-y-auto p-6 bg-gray-50/50 dark:bg-gray-900/50 custom-scrollbar\">\n\n                    {headingOptimizations.length === 0 && !isAnalyzing ? (\n                        <div className=\"flex flex-col items-center justify-center h-64 text-center\">\n                            <div className=\"w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mb-4\">\n                                <Wand2 className=\"w-8 h-8 text-blue-500\" />\n                            </div>\n                            <h3 className=\"text-lg font-semibold text-gray-700 mb-2\">Ready to Optimize?</h3>\n                            <p className=\"text-gray-500 max-w-sm mb-6\">\n                                We will analyze your article's structure and suggest 5 variations for each H2 heading (Professional, Emotional, Viral, etc.).\n                            </p>\n                            <button\n                                onClick={handleAnalyze}\n                                className=\"px-6 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg shadow-sm shadow-blue-200 transition-all flex items-center gap-2\"\n                            >\n                                <Sparkles className=\"w-4 h-4\" />\n                                Generate Suggestions\n                            </button>\n                        </div>\n                    ) : isAnalyzing ? (\n                        <div className=\"flex flex-col items-center justify-center h-64\">\n                            <Loader2 className=\"w-8 h-8 text-blue-600 animate-spin mb-4\" />\n                            <p className=\"text-gray-600 font-medium\">Analyzing article structure...</p>\n                            <p className=\"text-sm text-gray-400 mt-1\">Generating high-converting headline variations</p>\n                        </div>\n                    ) : (\n                        <div className=\"space-y-4\">\n                            {headingOptimizations.map((opt, idx) => {\n                                const isExpanded = expandedIndex === idx;\n                                const isSelectedChanged = selectedOptions[idx] !== opt.h2_before;\n\n                                return (\n                                    <div key={idx} className={`bg-white dark:bg-gray-800 rounded-lg border transition-all duration-200 ${isExpanded ? 'border-blue-300 shadow-md ring-1 ring-blue-100' : 'border-gray-200 hover:border-blue-200'}`}>\n                                        {/* Row Header */}\n                                        <div\n                                            className=\"flex items-center gap-4 p-4 cursor-pointer\"\n                                            onClick={() => setExpandedIndex(isExpanded ? null : idx)}\n                                        >\n                                            <button className=\"p-1 text-gray-400 hover:text-gray-600\">\n                                                {isExpanded ? <ChevronDown className=\"w-4 h-4\" /> : <ChevronRight className=\"w-4 h-4\" />}\n                                            </button>\n\n                                            <div className=\"flex-1\">\n                                                <div className=\"text-xs font-semibold text-gray-400 uppercase tracking-wider mb-0.5\">Section {idx + 1}</div>\n                                                <div className=\"font-medium text-gray-800 dark:text-gray-200 flex items-center gap-2\">\n                                                    {selectedOptions[idx] || opt.h2_before}\n                                                    {isSelectedChanged && (\n                                                        <span className=\"px-1.5 py-0.5 bg-green-100 text-green-700 text-[10px] rounded border border-green-200 font-bold\">UPDATED</span>\n                                                    )}\n                                                </div>\n                                            </div>\n\n                                            {(!isExpanded && isSelectedChanged) && (\n                                                <div className=\"text-xs text-gray-400 italic\">\n                                                    Original: {opt.h2_before}\n                                                </div>\n                                            )}\n                                        </div>\n\n                                        {/* Expanded Options */}\n                                        {isExpanded && (\n                                            <div className=\"border-t border-gray-100 dark:border-gray-700 p-4 bg-gray-50/50 dark:bg-gray-800/50\">\n                                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                                                    {/* Original Option */}\n                                                    <label\n                                                        className={`relative flex items-start gap-3 p-3 rounded-lg border cursor-pointer transition-all ${selectedOptions[idx] === opt.h2_before ? 'bg-white border-gray-400 ring-1 ring-gray-200' : 'bg-gray-50/50 border-transparent hover:bg-white hover:border-gray-200'}`}\n                                                        onClick={() => setSelectedOptions(prev => ({ ...prev, [idx]: opt.h2_before }))}\n                                                    >\n                                                        <div className={`mt-0.5 w-4 h-4 rounded-full border flex items-center justify-center ${selectedOptions[idx] === opt.h2_before ? 'border-gray-600 bg-gray-600' : 'border-gray-300 bg-white'}`}>\n                                                            {selectedOptions[idx] === opt.h2_before && <div className=\"w-1.5 h-1.5 rounded-full bg-white\" />}\n                                                        </div>\n                                                        <div>\n                                                            <div className=\"text-sm font-semibold text-gray-700\">Original</div>\n                                                            <div className=\"text-sm text-gray-600 mt-0.5\">{opt.h2_before}</div>\n                                                        </div>\n                                                    </label>\n\n                                                    {/* AI Options */}\n                                                    {opt.h2_options?.map((option, optIdx) => (\n                                                        <label\n                                                            key={optIdx}\n                                                            className={`relative flex items-start gap-3 p-3 rounded-lg border cursor-pointer transition-all ${selectedOptions[idx] === option.text ? 'bg-blue-50 border-blue-400 ring-1 ring-blue-200' : 'bg-white border-gray-200 hover:border-blue-300 shadow-sm'}`}\n                                                            onClick={() => setSelectedOptions(prev => ({ ...prev, [idx]: option.text }))}\n                                                        >\n                                                            <div className={`mt-0.5 w-4 h-4 rounded-full border flex items-center justify-center ${selectedOptions[idx] === option.text ? 'border-blue-500 bg-blue-500' : 'border-gray-300 bg-white'}`}>\n                                                                {selectedOptions[idx] === option.text && <div className=\"w-1.5 h-1.5 rounded-full bg-white\" />}\n                                                            </div>\n                                                            <div className=\"flex-1\">\n                                                                <div className=\"flex items-center justify-between\">\n                                                                    <div className=\"text-sm font-semibold text-gray-800\">{option.text}</div>\n                                                                    {option.score && (\n                                                                        <span className=\"text-[10px] font-bold text-blue-600 bg-blue-100 px-1.5 py-0.5 rounded px-1\">Score: {option.score}</span>\n                                                                    )}\n                                                                </div>\n                                                                {option.reason && (\n                                                                    <div className=\"text-xs text-gray-500 mt-1 leading-snug\">{option.reason}</div>\n                                                                )}\n                                                            </div>\n                                                        </label>\n                                                    ))}\n                                                </div>\n                                            </div>\n                                        )}\n                                    </div>\n                                );\n                            })}\n                        </div>\n                    )}\n                </div>\n\n                {/* Footer */}\n                <div className=\"p-4 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 flex items-center justify-between\">\n                    <div className=\"text-sm text-gray-500\">\n                        {headingOptimizations.length > 0 && (\n                            <button\n                                onClick={handleAnalyze}\n                                className=\"flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-gray-600 hover:text-blue-600 hover:bg-gray-100 rounded-md transition-colors\"\n                            >\n                                <RefreshCw className=\"w-3.5 h-3.5\" />\n                                Re-analyze\n                            </button>\n                        )}\n                    </div>\n                    <div className=\"flex items-center gap-3\">\n                        <button\n                            onClick={onClose}\n                            className=\"px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors\"\n                        >\n                            Cancel\n                        </button>\n                        <button\n                            onClick={handleApply}\n                            disabled={headingOptimizations.length === 0}\n                            className=\"px-6 py-2 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white text-sm font-semibold rounded-lg shadow-md hover:shadow-lg transition-all flex items-center gap-2\"\n                        >\n                            <Check className=\"w-4 h-4\" />\n                            Apply Selected Headings\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5073, "column": 0}, "map": {"version":3,"sources":["file:///Users/rose/Documents/this_month/write-content/best-ai-text-writer.com/src/components/Preview.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { marked } from 'marked';\nimport { Copy, Check, AlertCircle, Code, Eye, Terminal, FileDown, Loader2, Sparkles } from 'lucide-react';\nimport { GenerationStatus, TargetAudience, CostBreakdown, TokenUsage, SavedProfile, ScrapedImage, GenerationStep, ProductBrief } from '@/types';\nimport { RichTextEditor } from './RichTextEditor';\nimport { EditorProvider } from './editor/EditorContext';\nimport { StreamingModal } from './StreamingModal';\nimport { RegionGroundingModal } from './RegionGroundingModal';\nimport { HeadingOptimizerModal } from './HeadingOptimizerModal';\nimport { useAnalysisStore } from '@/store/useAnalysisStore';\nimport { useGenerationStore } from '@/store/useGenerationStore';\nimport { useAppStore } from '@/store/useAppStore';\n\ninterface PreviewProps {\n  content: string;\n  status: GenerationStatus;\n  error: string | null;\n  generationStep?: GenerationStep; // Added prop\n  keyInformationPoints?: string[];\n  brandExclusivePoints?: string[]; // NEW\n  coveredPoints?: string[];\n  targetAudience?: TargetAudience;\n  scrapedImages?: ScrapedImage[];\n  visualStyle?: string; // NEW\n  onTogglePoint?: (point: string) => void;\n  onRemoveScrapedImage?: (image: ScrapedImage) => void;\n  onAddCost?: (cost: CostBreakdown, usage: TokenUsage) => void;\n  savedProfiles?: SavedProfile[];\n  onLoadProfile?: (profile: SavedProfile) => void;\n  onRequestUrlMode?: () => void;\n  productBrief?: ProductBrief; // NEW\n  displayScale?: number;\n  articleTitle?: string;\n  onTitleChange?: (title: string) => void;\n  outlineSections?: string[];\n}\n\ntype ViewMode = 'visual' | 'code';\n\ninterface ToolbarActionsProps {\n  viewMode: ViewMode;\n  onChangeView: (mode: ViewMode) => void;\n  onCopyHtml: () => void;\n  onCopyMarkdown: () => void;\n  onOptimizeHeadings: () => void;\n  copied: boolean;\n\n  variant?: 'light' | 'dark';\n}\n\nconst ToolbarActions: React.FC<ToolbarActionsProps> = ({\n  viewMode,\n  onChangeView,\n  onCopyHtml,\n  onCopyMarkdown,\n  onOptimizeHeadings,\n  copied,\n\n  variant = 'light',\n}) => {\n  const isDark = variant === 'dark';\n  const toggleBase = isDark ? 'border-gray-700 bg-gray-800 text-gray-200' : 'border-gray-200 bg-white text-gray-700';\n  const toggleActive = isDark ? 'bg-blue-900/40 text-blue-100 border border-blue-500/40' : 'bg-blue-50 text-blue-700 border border-blue-200 shadow-sm';\n  const toggleInactive = isDark ? 'text-gray-300 hover:text-white hover:bg-gray-700' : 'text-gray-600 hover:bg-gray-50';\n  const copyButton = isDark\n    ? 'bg-gray-800 border border-gray-700 text-gray-200 hover:bg-gray-700'\n    : 'bg-white border border-gray-200 text-gray-600 hover:bg-gray-50';\n\n  return (\n    <div className=\"flex items-center gap-2 text-xs\">\n      <div className={`flex items-center rounded-md overflow-hidden ${toggleBase}`}>\n        <button\n          onClick={() => onChangeView('visual')}\n          className={`flex items-center gap-1 px-3 py-1.5 transition-colors ${viewMode === 'visual' ? toggleActive : toggleInactive}`}\n        >\n          <Eye className=\"w-3.5 h-3.5\" />\n          <span className=\"font-semibold\">Visual Editor</span>\n        </button>\n        <button\n          onClick={() => onChangeView('code')}\n          className={`flex items-center gap-1 px-3 py-1.5 transition-colors ${viewMode === 'code' ? toggleActive : toggleInactive}`}\n        >\n          <Code className=\"w-3.5 h-3.5\" />\n          <span className=\"font-semibold\">HTML Source</span>\n        </button>\n      </div>\n\n      <button\n        onClick={onCopyMarkdown}\n        className={`flex items-center gap-1.5 px-3 py-1.5 font-medium rounded-md transition-colors ${isDark ? 'bg-amber-900/30 text-amber-200 border border-amber-800 hover:bg-amber-900/50' : 'bg-amber-50 text-amber-700 border border-amber-200 hover:bg-amber-100'\n          }`}\n        title=\"Copy Markdown\"\n      >\n        <span>Copy MD</span>\n      </button>\n\n      <div className=\"w-px h-5 bg-gray-200 dark:bg-gray-700 mx-1\" />\n\n      <button\n        onClick={onOptimizeHeadings}\n        className={`flex items-center gap-1.5 px-3 py-1.5 font-medium rounded-md transition-colors border ${isDark ? 'bg-indigo-900/20 text-indigo-300 border-indigo-800 hover:bg-indigo-900/40' : 'bg-indigo-50 text-indigo-700 border-indigo-200 hover:bg-indigo-100'\n          }`}\n        title=\"Refine H2/H3 Headings with AI\"\n      >\n        <Sparkles className=\"w-4 h-4\" />\n        <span className=\"hidden sm:inline\">Opt. Headings</span>\n      </button>\n\n      <button\n        onClick={onCopyHtml}\n        className={`flex items-center gap-1 px-3 py-1.5 font-semibold rounded-md transition-colors ${copyButton}`}\n        title=\"Copy HTML Source\"\n      >\n        {copied ? <Check className=\"w-4 h-4 text-green-500\" /> : <Copy className=\"w-4 h-4\" />}\n        <span className={copied ? 'text-green-600' : ''}>{copied ? 'Copied' : 'HTML'}</span>\n      </button>\n    </div>\n  );\n};\n\nexport const Preview: React.FC<PreviewProps> = ({\n  content,\n  status,\n  error,\n  generationStep,\n  keyInformationPoints = [],\n  brandExclusivePoints = [], // NEW\n  coveredPoints = [],\n  targetAudience = 'zh-TW',\n  scrapedImages = [],\n  visualStyle = '',\n  onTogglePoint,\n  onRemoveScrapedImage,\n  onAddCost,\n  savedProfiles = [],\n  onLoadProfile,\n  onRequestUrlMode,\n  productBrief, // NEW\n  displayScale = 1,\n  articleTitle = '',\n  onTitleChange,\n  outlineSections = [],\n}) => {\n  const [copied, setCopied] = useState(false);\n  const [viewMode, setViewMode] = useState<ViewMode>('visual');\n  const [editorHtml, setEditorHtml] = useState('');\n  const [showHeadingOptimizer, setShowHeadingOptimizer] = useState(false);\n\n\n  // Region grounding modal state\n  const { pendingGroundingResult, showGroundingModal, setPendingGroundingResult, setShowGroundingModal } = useAnalysisStore();\n  const generationStore = useGenerationStore();\n\n  const isAnalyzing = status === 'analyzing';\n\n  // Handle applying selected grounding replacements\n  const handleApplyGrounding = useCallback((selectedIssues: { original: string; regionEquivalent: string }[]) => {\n    if (selectedIssues.length === 0) {\n      setPendingGroundingResult(null);\n      return;\n    }\n\n    let currentContent = generationStore.content;\n\n    // Apply each selected replacement\n    for (const issue of selectedIssues) {\n      if (issue.original && issue.regionEquivalent) {\n        // Use regex for global replacement\n        const regex = new RegExp(issue.original.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'), 'g');\n        currentContent = currentContent.replace(regex, issue.regionEquivalent);\n      }\n    }\n\n    generationStore.setContent(currentContent);\n    setPendingGroundingResult(null);\n    console.log(`[RegionGrounding] Applied ${selectedIssues.length} replacements`);\n  }, [generationStore, setPendingGroundingResult]);\n\n  // Handle skipping grounding (keep original)\n  const handleSkipGrounding = useCallback(() => {\n    setPendingGroundingResult(null);\n    console.log('[RegionGrounding] User skipped all replacements');\n  }, [setPendingGroundingResult]);\n\n  // Start every new analysis with a clean editor to avoid showing stale drafts\n  useEffect(() => {\n    if (status === 'analyzing') {\n      setEditorHtml('');\n    }\n  }, [status]);\n\n  useEffect(() => {\n    if (status === 'completed' && content) {\n      const parsed = marked.parse(content, { async: false }) as string;\n      setEditorHtml(parsed);\n    }\n  }, [status, content]);\n\n  const handleCopy = () => {\n    const textToCopy = editorHtml;\n    navigator.clipboard.writeText(textToCopy || content);\n\n    setCopied(true);\n    setTimeout(() => setCopied(false), 2000);\n  };\n\n  // Simple HTML to Markdown Converter for the Copy function\n  const htmlToMarkdown = (html: string): string => {\n    let md = html;\n\n    // Block elements to newlines\n    md = md.replace(/<p[^>]*>/gi, \"\").replace(/<\\/p>/gi, \"\\n\\n\");\n    md = md.replace(/<br\\s*\\/?>/gi, \"\\n\");\n    md = md.replace(/<div[^>]*>/gi, \"\").replace(/<\\/div>/gi, \"\\n\");\n    md = md.replace(/<hr[^>]*>/gi, \"\\n---\\n\");\n\n    // Headings\n    md = md.replace(/<h1[^>]*>(.*?)<\\/h1>/gi, \"# $1\\n\\n\");\n    md = md.replace(/<h2[^>]*>(.*?)<\\/h2>/gi, \"## $1\\n\\n\");\n    md = md.replace(/<h3[^>]*>(.*?)<\\/h3>/gi, \"### $1\\n\\n\");\n    md = md.replace(/<h4[^>]*>(.*?)<\\/h4>/gi, \"#### $1\\n\\n\");\n\n    // Bold/Italic\n    md = md.replace(/<strong[^>]*>(.*?)<\\/strong>/gi, \"**$1**\");\n    md = md.replace(/<b[^>]*>(.*?)<\\/b>/gi, \"**$1**\");\n    md = md.replace(/<em[^>]*>(.*?)<\\/em>/gi, \"*$1*\");\n    md = md.replace(/<i[^>]*>(.*?)<\\/i>/gi, \"*$1*\");\n\n    // Lists (Simple implementation)\n    md = md.replace(/<ul[^>]*>/gi, \"\").replace(/<\\/ul>/gi, \"\\n\");\n    md = md.replace(/<ol[^>]*>/gi, \"\").replace(/<\\/ol>/gi, \"\\n\");\n    md = md.replace(/<li[^>]*>(.*?)<\\/li>/gi, \"- $1\\n\");\n\n    // Images\n    md = md.replace(/<img[^>]*src=\"([^\"]*)\"[^>]*alt=\"([^\"]*)\"[^>]*>/gi, \"![$2]($1)\");\n    md = md.replace(/<img[^>]*src=\"([^\"]*)\"[^>]*>/gi, \"![]($1)\");\n\n    // Links\n    md = md.replace(/<a[^>]*href=\"([^\"]*)\"[^>]*>(.*?)<\\/a>/gi, \"[$2]($1)\");\n\n    // Blockquotes\n    md = md.replace(/<blockquote[^>]*>/gi, \"> \").replace(/<\\/blockquote>/gi, \"\\n\\n\");\n\n    // Cleanup HTML entities (basic)\n    md = md.replace(/&nbsp;/g, \" \");\n    md = md.replace(/&amp;/g, \"&\");\n    md = md.replace(/&lt;/g, \"<\");\n    md = md.replace(/&gt;/g, \">\");\n    md = md.replace(/&quot;/g, '\"');\n\n    // Cleanup multiple newlines\n    md = md.replace(/\\n\\s*\\n\\s*\\n/g, \"\\n\\n\");\n\n    return md.trim();\n  };\n\n  const handleCopyMarkdown = () => {\n    const md = htmlToMarkdown(editorHtml);\n    navigator.clipboard.writeText(md);\n    alert(\"Markdown copied to clipboard!\");\n  };\n\n  const renderToolbarActions = (variant: 'light' | 'dark' = 'light') => (\n    <ToolbarActions\n      viewMode={viewMode}\n      onChangeView={setViewMode}\n      onCopyHtml={handleCopy}\n      onCopyMarkdown={handleCopyMarkdown}\n      onOptimizeHeadings={() => setShowHeadingOptimizer(true)}\n      copied={copied}\n\n      variant={variant}\n    />\n  );\n\n  const getStepLabel = (step?: GenerationStep) => {\n    switch (step) {\n      case 'parsing_product': return '正在讀取產品資訊';\n      case 'nlp_analysis': return '正在整理重點字詞';\n      case 'extracting_structure': return '正在歸納段落架構';\n      case 'analyzing_visuals': return '正在偵測圖片風格';\n      case 'planning_keywords': return '正在規劃常用詞與例句';\n      case 'mapping_product': return '正在配對痛點與賣點';\n      case 'localizing_hk': return '正在套用香港市場用語';\n      default: return 'AI 正在準備';\n    }\n  };\n\n  const InlineAnalysisIndicator = () => (\n    <div className=\"absolute inset-0 z-40 bg-white/80 backdrop-blur-sm flex flex-col items-center justify-center\">\n      <div className=\"flex flex-col items-center gap-4 animate-in fade-in zoom-in-95 duration-500\">\n        <div className=\"relative\">\n          <div className=\"w-16 h-16 rounded-full border-4 border-blue-100 border-t-blue-500 animate-spin\"></div>\n          <div className=\"absolute inset-0 flex items-center justify-center\">\n            <Sparkles className=\"w-6 h-6 text-blue-500 animate-pulse\" />\n          </div>\n        </div>\n        <div className=\"text-center\">\n          <h3 className=\"text-xl font-bold text-gray-800 tracking-tight\">\n            {getStepLabel(generationStep)}\n          </h3>\n          <p className=\"text-sm text-gray-500 font-medium mt-1\">請查看右側面板以獲取即時分析結果...</p>\n        </div>\n      </div>\n    </div>\n  );\n\n  if (status === 'error') {\n    return (\n      <div className=\"flex-1 flex items-center justify-center p-10 bg-gray-50\">\n        <div className=\"bg-red-50 border border-red-200 rounded-xl p-6 max-w-lg flex items-start space-x-4 text-red-700\">\n          <AlertCircle className=\"w-6 h-6 flex-shrink-0\" />\n          <div>\n            <h3 className=\"font-semibold text-lg\">Generation Failed</h3>\n            <p className=\"mt-1 text-sm text-red-600\">{error}</p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex flex-col h-full w-full\">\n      <div className=\"flex-1 overflow-hidden bg-white relative w-full h-full min-h-0\">\n        <div className=\"w-full h-full min-h-0 transition-opacity duration-300\">\n          {viewMode === 'visual' ? (\n            <EditorProvider>\n              <RichTextEditor\n                initialHtml={editorHtml}\n                onChange={setEditorHtml}\n                displayScale={displayScale}\n                articleTitle={articleTitle}\n                onTitleChange={onTitleChange}\n                toolbarExtras={renderToolbarActions('light')}\n              />\n            </EditorProvider>\n          ) : (\n            <div className=\"h-full w-full bg-gray-900 flex flex-col\">\n              <div className=\"bg-gray-800 text-gray-200 px-4 py-2 text-xs font-mono flex flex-wrap items-center justify-between gap-3 border-b border-gray-700\">\n                <div className=\"flex items-center gap-2\">\n                  <Terminal className=\"w-3 h-3\" />\n                  <span>source.html</span>\n                  <span className=\"text-[11px] text-gray-400\">{editorHtml.length} chars</span>\n                </div>\n                {renderToolbarActions('dark')}\n              </div>\n              <textarea\n                className=\"flex-1 w-full p-6 font-mono text-sm bg-gray-900 text-gray-100 focus:outline-none resize-none custom-scrollbar leading-relaxed\"\n                value={editorHtml}\n                onChange={(e) => setEditorHtml(e.target.value)}\n                spellCheck={false}\n                placeholder=\"<!-- HTML content will appear here -->\"\n              />\n            </div>\n          )}\n        </div>\n\n        {isAnalyzing && <InlineAnalysisIndicator />}\n\n        <RegionGroundingModal\n          onApply={handleApplyGrounding}\n          onSkip={handleSkipGrounding}\n        />\n\n        <HeadingOptimizerModal\n          isOpen={showHeadingOptimizer}\n          onClose={() => setShowHeadingOptimizer(false)}\n          onApply={(newContent) => {\n            setEditorHtml(newContent);\n            generationStore.setContent(newContent);\n          }}\n        />\n        <StreamingModal\n          isOpen={status === 'streaming'}\n          content={content}\n          step={generationStep || 'writing_content'}\n        />\n\n\n      </div>\n    </div>\n  );\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5665, "column": 0}, "map": {"version":3,"sources":["file:///Users/rose/Documents/this_month/write-content/best-ai-text-writer.com/src/components/Changelog.tsx"],"sourcesContent":["\nimport React from 'react';\nimport { X, GitCommit } from 'lucide-react';\n\ninterface ChangelogProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nconst HISTORY = [\n  {\n    version: 'v1.5.0',\n    date: '2025.12',\n    description: '核心模型升級：全面採用 Google 最新 Gemini 3 Flash Preview 模型，大幅提升生成速度與內容準確度，並優化長文本處理能力。'\n  },\n  {\n    version: 'v1.4.0',\n    date: '2025.12',\n    description: '功能重構與優化：將關鍵詞分析升級為「高頻詞彙 (Frequent Words)」並增加例句提取功能；新增「區域化與安全 (Localization & Safety)」檢查面板以強化內容合規。底層則透過並行化處理修復了同步問題，顯著提升分析速度。'\n  },\n  {\n    version: 'v1.3.0',\n    date: '2025.03',\n    description: '體驗大幅升級：推出「全域視覺識別系統 (VIS)」，確保生成圖片風格的一致性。新增「游標處插入」功能，讓圖片素材能一鍵放入文章。同時優化了底層處理效能，提升整體回應速度。'\n  },\n  {\n    version: 'v1.2.0',\n    date: '2025.02',\n    description: '整合 Gemini 3 Pro (Nano Banana) 生成高保真圖像，並支援來源圖片的 AI 視覺理解。'\n  },\n  {\n    version: 'v1.1.0',\n    date: '2025.01',\n    description: '新增知識庫 RAG 檢索與競爭對手清洗 (Competitor Sanitization) 協議。'\n  },\n  {\n    version: 'v1.0.0',\n    date: '2024.12',\n    description: '核心「分析-規劃-寫作」架構上線，具備深度結構提取功能。'\n  }\n];\n\nexport const Changelog: React.FC<ChangelogProps> = ({ isOpen, onClose }) => {\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-[60] flex justify-end\">\n      {/* Backdrop */}\n      <div\n        className=\"absolute inset-0 bg-black/20 backdrop-blur-sm animate-in fade-in duration-200\"\n        onClick={onClose}\n      />\n\n      {/* Slide-over Panel */}\n      <div className=\"relative w-full max-w-sm bg-white h-full shadow-2xl border-l border-gray-200 flex flex-col animate-in slide-in-from-right duration-300\">\n\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-5 border-b border-gray-100 bg-gray-50/50\">\n          <h2 className=\"text-base font-bold text-gray-800 flex items-center gap-2\">\n            <GitCommit className=\"w-4 h-4 text-blue-600\" />\n            更新日誌\n          </h2>\n          <button\n            onClick={onClose}\n            className=\"p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors\"\n          >\n            <X className=\"w-4 h-4\" />\n          </button>\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 overflow-y-auto custom-scrollbar p-6\">\n\n          {/* Product Overview */}\n          <div className=\"mb-10\">\n            <h3 className=\"text-lg font-bold text-gray-900 mb-2\">Ai Text Writer Pro</h3>\n            <p className=\"text-sm text-gray-500 leading-relaxed\">\n              專為高轉換率編輯內容設計的專業級 AI 寫作工作區，利用深度結構分析與 RAG 技術，填補通用 LLM 輸出與專業內容之間的差距。\n            </p>\n          </div>\n\n          {/* Version List */}\n          <div className=\"space-y-8 relative\">\n            {/* Timeline Line */}\n            <div className=\"absolute left-[3px] top-2 bottom-2 w-px bg-gray-100\"></div>\n\n            {HISTORY.map((item, idx) => (\n              <div key={idx} className=\"relative pl-6\">\n                <div className={`absolute left-0 top-1.5 w-1.5 h-1.5 rounded-full ring-4 ring-white ${idx === 0 ? 'bg-blue-600' : 'bg-gray-300'}`}></div>\n\n                <div className=\"flex flex-col gap-1 mb-2\">\n                  <span className={`text-sm font-bold ${idx === 0 ? 'text-blue-700' : 'text-gray-900'}`}>\n                    {item.version}\n                  </span>\n                  <span className=\"text-xs text-gray-400 font-mono tracking-wide\">\n                    {item.date}\n                  </span>\n                </div>\n                <p className=\"text-sm text-gray-600 leading-relaxed\">\n                  {item.description}\n                </p>\n              </div>\n            ))}\n          </div>\n\n        </div>\n      </div>\n    </div>\n  );\n};\n"],"names":[],"mappings":";;;;;AAEA;AAAA;;;AAOA,MAAM,UAAU;IACd;QACE,SAAS;QACT,MAAM;QACN,aAAa;IACf;IACA;QACE,SAAS;QACT,MAAM;QACN,aAAa;IACf;IACA;QACE,SAAS;QACT,MAAM;QACN,aAAa;IACf;IACA;QACE,SAAS;QACT,MAAM;QACN,aAAa;IACf;IACA;QACE,SAAS;QACT,MAAM;QACN,aAAa;IACf;IACA;QACE,SAAS;QACT,MAAM;QACN,aAAa;IACf;CACD;AAEM,MAAM,YAAsC,CAAC,EAAE,MAAM,EAAE,OAAO,EAAE;IACrE,IAAI,CAAC,QAAQ,OAAO;IAEpB,qBACE,8OAAC;QAAI,WAAU;;0BAEb,8OAAC;gBACC,WAAU;gBACV,SAAS;;;;;;0BAIX,8OAAC;gBAAI,WAAU;;kCAGb,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAG,WAAU;;kDACZ,8OAAC,2OAAS;wCAAC,WAAU;;;;;;oCAA0B;;;;;;;0CAGjD,8OAAC;gCACC,SAAS;gCACT,WAAU;0CAEV,cAAA,8OAAC,iMAAC;oCAAC,WAAU;;;;;;;;;;;;;;;;;kCAKjB,8OAAC;wBAAI,WAAU;;0CAGb,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAG,WAAU;kDAAuC;;;;;;kDACrD,8OAAC;wCAAE,WAAU;kDAAwC;;;;;;;;;;;;0CAMvD,8OAAC;gCAAI,WAAU;;kDAEb,8OAAC;wCAAI,WAAU;;;;;;oCAEd,QAAQ,GAAG,CAAC,CAAC,MAAM,oBAClB,8OAAC;4CAAc,WAAU;;8DACvB,8OAAC;oDAAI,WAAW,CAAC,mEAAmE,EAAE,QAAQ,IAAI,gBAAgB,eAAe;;;;;;8DAEjI,8OAAC;oDAAI,WAAU;;sEACb,8OAAC;4DAAK,WAAW,CAAC,kBAAkB,EAAE,QAAQ,IAAI,kBAAkB,iBAAiB;sEAClF,KAAK,OAAO;;;;;;sEAEf,8OAAC;4DAAK,WAAU;sEACb,KAAK,IAAI;;;;;;;;;;;;8DAGd,8OAAC;oDAAE,WAAU;8DACV,KAAK,WAAW;;;;;;;2CAZX;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsBxB"}},
    {"offset": {"line": 5879, "column": 0}, "map": {"version":3,"sources":["file:///Users/rose/Documents/this_month/write-content/best-ai-text-writer.com/src/components/PasswordGate.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState } from 'react';\n\ninterface PasswordGateProps {\n    passwordHash?: string;\n    onUnlock: () => void;\n}\n\nconst hashText = async (text: string) => {\n    const encoder = new TextEncoder();\n    const data = encoder.encode(text);\n    const hashBuffer = await crypto.subtle.digest('SHA-256', data);\n    return Array.from(new Uint8Array(hashBuffer))\n        .map((b) => b.toString(16).padStart(2, '0'))\n        .join('');\n};\n\nexport const PasswordGate: React.FC<PasswordGateProps> = ({ passwordHash = '', onUnlock }) => {\n    const [input, setInput] = useState('');\n    const [error, setError] = useState('');\n    const [isLoading, setIsLoading] = useState(false);\n\n    const handleSubmit = async (e: React.FormEvent) => {\n        e.preventDefault();\n        setError('');\n        if (!passwordHash) {\n            setError('Password is not configured. Please set VITE_APP_GUARD_HASH.');\n            return;\n        }\n        setIsLoading(true);\n        try {\n            const hashed = await hashText(input.trim());\n            if (hashed === passwordHash) {\n                onUnlock();\n            } else {\n                setError('Incorrect password.');\n            }\n        } catch (err) {\n            console.error('Password hash failed', err);\n            setError('Something went wrong. Please try again.');\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    return (\n        <div className=\"min-h-screen w-full bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white flex items-center justify-center p-6\">\n            <div className=\"w-full max-w-md bg-slate-900/70 border border-slate-700 rounded-2xl shadow-2xl p-6 backdrop-blur\">\n                <div className=\"flex items-center justify-between mb-4\">\n                    <div>\n                        <p className=\"text-xs uppercase tracking-[0.3em] text-slate-400\">Restricted Area</p>\n                        <h1 className=\"text-xl font-semibold text-white mt-1\">Enter Access Code</h1>\n                    </div>\n                </div>\n\n                <form onSubmit={handleSubmit} className=\"space-y-4\">\n                    <div className=\"space-y-2\">\n                        <label className=\"text-sm text-slate-300\">Password</label>\n                        <input\n                            type=\"password\"\n                            value={input}\n                            onChange={(e) => setInput(e.target.value)}\n                            className=\"w-full px-3 py-2 rounded-lg bg-slate-800 border border-slate-700 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                            placeholder=\"Enter password\"\n                            autoFocus\n                        />\n                    </div>\n\n                    {error && (\n                        <div className=\"text-sm text-red-400 bg-red-950/40 border border-red-800 rounded-lg px-3 py-2\">\n                            {error}\n                        </div>\n                    )}\n\n                    <button\n                        type=\"submit\"\n                        disabled={isLoading}\n                        className=\"w-full py-2 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700 transition-colors disabled:opacity-60\"\n                    >\n                        {isLoading ? 'Verifying...' : 'Unlock'}\n                    </button>\n                </form>\n            </div>\n        </div>\n    );\n};\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AASA,MAAM,WAAW,OAAO;IACpB,MAAM,UAAU,IAAI;IACpB,MAAM,OAAO,QAAQ,MAAM,CAAC;IAC5B,MAAM,aAAa,MAAM,OAAO,MAAM,CAAC,MAAM,CAAC,WAAW;IACzD,OAAO,MAAM,IAAI,CAAC,IAAI,WAAW,aAC5B,GAAG,CAAC,CAAC,IAAM,EAAE,QAAQ,CAAC,IAAI,QAAQ,CAAC,GAAG,MACtC,IAAI,CAAC;AACd;AAEO,MAAM,eAA4C,CAAC,EAAE,eAAe,EAAE,EAAE,QAAQ,EAAE;IACrF,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAC;IACnC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAC;IACnC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAE3C,MAAM,eAAe,OAAO;QACxB,EAAE,cAAc;QAChB,SAAS;QACT,IAAI,CAAC,cAAc;YACf,SAAS;YACT;QACJ;QACA,aAAa;QACb,IAAI;YACA,MAAM,SAAS,MAAM,SAAS,MAAM,IAAI;YACxC,IAAI,WAAW,cAAc;gBACzB;YACJ,OAAO;gBACH,SAAS;YACb;QACJ,EAAE,OAAO,KAAK;YACV,QAAQ,KAAK,CAAC,wBAAwB;YACtC,SAAS;QACb,SAAU;YACN,aAAa;QACjB;IACJ;IAEA,qBACI,8OAAC;QAAI,WAAU;kBACX,cAAA,8OAAC;YAAI,WAAU;;8BACX,8OAAC;oBAAI,WAAU;8BACX,cAAA,8OAAC;;0CACG,8OAAC;gCAAE,WAAU;0CAAoD;;;;;;0CACjE,8OAAC;gCAAG,WAAU;0CAAwC;;;;;;;;;;;;;;;;;8BAI9D,8OAAC;oBAAK,UAAU;oBAAc,WAAU;;sCACpC,8OAAC;4BAAI,WAAU;;8CACX,8OAAC;oCAAM,WAAU;8CAAyB;;;;;;8CAC1C,8OAAC;oCACG,MAAK;oCACL,OAAO;oCACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;oCACxC,WAAU;oCACV,aAAY;oCACZ,SAAS;;;;;;;;;;;;wBAIhB,uBACG,8OAAC;4BAAI,WAAU;sCACV;;;;;;sCAIT,8OAAC;4BACG,MAAK;4BACL,UAAU;4BACV,WAAU;sCAET,YAAY,iBAAiB;;;;;;;;;;;;;;;;;;;;;;;AAMtD"}},
    {"offset": {"line": 6029, "column": 0}, "map": {"version":3,"sources":["file:///Users/rose/Documents/this_month/write-content/best-ai-text-writer.com/src/components/ReplacementEditorModal.tsx"],"sourcesContent":["import React, { useState, useEffect, useMemo } from 'react';\nimport { X, RefreshCw, Check, Trash2, Edit3, Undo2, ArrowRight } from 'lucide-react';\n\nexport interface ReplacementItem {\n    original: string;\n    replacement: string;\n    reason?: string;\n}\n\nexport interface EditedReplacementItem extends ReplacementItem {\n    action: 'replace' | 'keep' | 'delete';\n    customReplacement?: string;\n}\n\ninterface ReplacementEditorModalProps {\n    open: boolean;\n    onClose: () => void;\n    items: ReplacementItem[];\n    onSave: (items: EditedReplacementItem[]) => void;\n}\n\nexport const ReplacementEditorModal: React.FC<ReplacementEditorModalProps> = ({\n    open,\n    onClose,\n    items,\n    onSave,\n}) => {\n    const [editedItems, setEditedItems] = useState<EditedReplacementItem[]>([]);\n    const [editingIndex, setEditingIndex] = useState<number | null>(null);\n    const [tempValue, setTempValue] = useState('');\n\n    useEffect(() => {\n        if (open) {\n            setEditedItems(\n                items.map((item) => ({\n                    ...item,\n                    action: item.replacement ? 'replace' : 'delete',\n                    customReplacement: item.replacement,\n                }))\n            );\n            setEditingIndex(null);\n            setTempValue('');\n        }\n    }, [open, items]);\n\n    const handleAction = (index: number, action: 'replace' | 'keep' | 'delete') => {\n        setEditedItems((prev) =>\n            prev.map((item, i) =>\n                i === index\n                    ? {\n                        ...item,\n                        action,\n                        customReplacement: action === 'keep' ? '' : item.customReplacement,\n                    }\n                    : item\n            )\n        );\n    };\n\n    const handleStartEdit = (index: number) => {\n        setEditingIndex(index);\n        setTempValue(editedItems[index]?.customReplacement || '');\n    };\n\n    const handleSaveEdit = (index: number) => {\n        setEditedItems((prev) =>\n            prev.map((item, i) =>\n                i === index ? { ...item, customReplacement: tempValue, action: 'replace' } : item\n            )\n        );\n        setEditingIndex(null);\n        setTempValue('');\n    };\n\n    const handleCancelEdit = () => {\n        setEditingIndex(null);\n        setTempValue('');\n    };\n\n    const handleSaveAll = () => {\n        onSave(editedItems);\n        onClose();\n    };\n\n    const summary = useMemo(() => {\n        const replaceCount = editedItems.filter((item) => item.action === 'replace').length;\n        const keepCount = editedItems.filter((item) => item.action === 'keep').length;\n        const deleteCount = editedItems.filter((item) => item.action === 'delete').length;\n        return { replaceCount, keepCount, deleteCount };\n    }, [editedItems]);\n\n    if (!open) return null;\n\n    return (\n        <div className=\"fixed inset-0 z-[80] flex items-center justify-center p-4\">\n            <div className=\"absolute inset-0 bg-black/50 backdrop-blur-sm\" onClick={onClose} />\n            <div className=\"relative bg-white w-full max-w-2xl max-h-[80vh] rounded-2xl shadow-2xl border border-gray-200 flex flex-col overflow-hidden\">\n                {/* Header */}\n                <div className=\"px-6 py-4 border-b border-gray-100 bg-gradient-to-r from-amber-50 to-orange-50 flex items-center justify-between gap-3\">\n                    <div className=\"flex items-center gap-3\">\n                        <div className=\"w-10 h-10 rounded-xl bg-amber-600 text-white flex items-center justify-center shadow-lg shadow-amber-200\">\n                            <RefreshCw className=\"w-5 h-5\" />\n                        </div>\n                        <div className=\"flex flex-col\">\n                            <h3 className=\"text-lg font-bold text-gray-900 leading-tight\">本地替換編輯器</h3>\n                            <p className=\"text-xs text-gray-500\">選擇替換、保留原文或刪除各項目</p>\n                        </div>\n                    </div>\n                    <button\n                        onClick={onClose}\n                        className=\"p-2 rounded-lg hover:bg-white/80 text-gray-500 transition\"\n                        aria-label=\"Close modal\"\n                    >\n                        <X className=\"w-5 h-5\" />\n                    </button>\n                </div>\n\n                {/* Content */}\n                <div className=\"flex-1 overflow-y-auto custom-scrollbar p-4 space-y-3\">\n                    {editedItems.length === 0 ? (\n                        <p className=\"text-sm text-gray-500 text-center py-8\">沒有需要替換的項目。</p>\n                    ) : (\n                        editedItems.map((item, idx) => (\n                            <div\n                                key={idx}\n                                className={`rounded-xl border p-4 transition-all ${item.action === 'replace'\n                                        ? 'bg-amber-50/50 border-amber-200'\n                                        : item.action === 'keep'\n                                            ? 'bg-blue-50/50 border-blue-200'\n                                            : 'bg-red-50/50 border-red-200'\n                                    }`}\n                            >\n                                <div className=\"flex items-start justify-between gap-3\">\n                                    <div className=\"flex-1\">\n                                        <div className=\"flex items-center gap-2 flex-wrap mb-2\">\n                                            <span className=\"text-red-500 line-through font-medium\">\n                                                {item.original}\n                                            </span>\n                                            {item.action !== 'keep' && (\n                                                <>\n                                                    <ArrowRight className=\"w-4 h-4 text-gray-400\" />\n                                                    {editingIndex === idx ? (\n                                                        <div className=\"flex items-center gap-2\">\n                                                            <input\n                                                                type=\"text\"\n                                                                value={tempValue}\n                                                                onChange={(e) => setTempValue(e.target.value)}\n                                                                className=\"px-2 py-1 text-sm border border-amber-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-200\"\n                                                                placeholder=\"輸入替換文字...\"\n                                                                autoFocus\n                                                            />\n                                                            <button\n                                                                onClick={() => handleSaveEdit(idx)}\n                                                                className=\"p-1.5 rounded-lg bg-emerald-100 text-emerald-700 hover:bg-emerald-200 transition\"\n                                                            >\n                                                                <Check className=\"w-4 h-4\" />\n                                                            </button>\n                                                            <button\n                                                                onClick={handleCancelEdit}\n                                                                className=\"p-1.5 rounded-lg bg-gray-100 text-gray-600 hover:bg-gray-200 transition\"\n                                                            >\n                                                                <X className=\"w-4 h-4\" />\n                                                            </button>\n                                                        </div>\n                                                    ) : (\n                                                        <>\n                                                            {item.action === 'delete' ? (\n                                                                <span className=\"text-red-500 font-semibold italic\">\n                                                                    (刪除)\n                                                                </span>\n                                                            ) : (\n                                                                <span className=\"text-emerald-600 font-semibold\">\n                                                                    {item.customReplacement || item.replacement || '(未設定)'}\n                                                                </span>\n                                                            )}\n                                                            {item.action === 'replace' && (\n                                                                <button\n                                                                    onClick={() => handleStartEdit(idx)}\n                                                                    className=\"p-1 rounded-lg hover:bg-amber-100 text-amber-600 transition\"\n                                                                    title=\"編輯替換文字\"\n                                                                >\n                                                                    <Edit3 className=\"w-3.5 h-3.5\" />\n                                                                </button>\n                                                            )}\n                                                        </>\n                                                    )}\n                                                </>\n                                            )}\n                                            {item.action === 'keep' && (\n                                                <span className=\"text-blue-600 font-semibold\">(保留原文)</span>\n                                            )}\n                                        </div>\n                                        {item.reason && (\n                                            <p className=\"text-xs text-gray-500 leading-relaxed\">{item.reason}</p>\n                                        )}\n                                    </div>\n                                </div>\n\n                                {/* Action buttons */}\n                                <div className=\"mt-3 flex items-center gap-2 flex-wrap\">\n                                    <button\n                                        onClick={() => handleAction(idx, 'replace')}\n                                        className={`px-3 py-1.5 text-xs font-semibold rounded-lg border transition flex items-center gap-1.5 ${item.action === 'replace'\n                                                ? 'bg-amber-600 text-white border-amber-600'\n                                                : 'bg-white text-amber-700 border-amber-200 hover:bg-amber-50'\n                                            }`}\n                                    >\n                                        <RefreshCw className=\"w-3.5 h-3.5\" />\n                                        替換\n                                    </button>\n                                    <button\n                                        onClick={() => handleAction(idx, 'keep')}\n                                        className={`px-3 py-1.5 text-xs font-semibold rounded-lg border transition flex items-center gap-1.5 ${item.action === 'keep'\n                                                ? 'bg-blue-600 text-white border-blue-600'\n                                                : 'bg-white text-blue-700 border-blue-200 hover:bg-blue-50'\n                                            }`}\n                                    >\n                                        <Undo2 className=\"w-3.5 h-3.5\" />\n                                        保留\n                                    </button>\n                                    <button\n                                        onClick={() => handleAction(idx, 'delete')}\n                                        className={`px-3 py-1.5 text-xs font-semibold rounded-lg border transition flex items-center gap-1.5 ${item.action === 'delete'\n                                                ? 'bg-red-600 text-white border-red-600'\n                                                : 'bg-white text-red-700 border-red-200 hover:bg-red-50'\n                                            }`}\n                                    >\n                                        <Trash2 className=\"w-3.5 h-3.5\" />\n                                        刪除\n                                    </button>\n                                </div>\n                            </div>\n                        ))\n                    )}\n                </div>\n\n                {/* Footer */}\n                <div className=\"px-6 py-4 border-t border-gray-100 bg-gray-50/50 flex items-center justify-between gap-3\">\n                    <div className=\"flex items-center gap-3 text-xs text-gray-500\">\n                        <span className=\"px-2 py-1 bg-amber-100 text-amber-700 rounded-full font-semibold\">\n                            替換: {summary.replaceCount}\n                        </span>\n                        <span className=\"px-2 py-1 bg-blue-100 text-blue-700 rounded-full font-semibold\">\n                            保留: {summary.keepCount}\n                        </span>\n                        <span className=\"px-2 py-1 bg-red-100 text-red-700 rounded-full font-semibold\">\n                            刪除: {summary.deleteCount}\n                        </span>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                        <button\n                            onClick={onClose}\n                            className=\"px-4 py-2 text-sm font-semibold text-gray-700 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition\"\n                        >\n                            取消\n                        </button>\n                        <button\n                            onClick={handleSaveAll}\n                            className=\"px-4 py-2 text-sm font-semibold text-white bg-gradient-to-r from-amber-600 to-orange-600 rounded-lg shadow-sm hover:brightness-110 transition\"\n                        >\n                            儲存變更\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6517, "column": 0}, "map": {"version":3,"sources":["file:///Users/rose/Documents/this_month/write-content/best-ai-text-writer.com/src/components/SettingsModal.tsx"],"sourcesContent":["'use client';\n\nimport React from 'react';\nimport { X, Settings, Database, Cpu, Hash, RotateCcw, Save } from 'lucide-react';\nimport { useAppStore } from '@/store/useAppStore';\n\ninterface SettingsModalProps {\n    open: boolean;\n    onClose: () => void;\n}\n\nexport const SettingsModal: React.FC<SettingsModalProps> = ({ open, onClose }) => {\n    const {\n        modelFlash,\n        modelImage,\n        keywordCharDivisor,\n        minKeywords,\n        maxKeywords,\n        setModelFlash,\n        setModelImage,\n        setKeywordCharDivisor,\n        setMinKeywords,\n        setMaxKeywords,\n        resetSettings: resetToDefaults\n    } = useAppStore();\n\n    if (!open) return null;\n\n    return (\n        <div className=\"fixed inset-0 z-[100] flex items-center justify-center p-4\">\n            <div className=\"absolute inset-0 bg-gray-900/60 backdrop-blur-md\" onClick={onClose} />\n\n            <div className=\"relative bg-white w-full max-w-lg rounded-3xl shadow-2xl border border-gray-100 flex flex-col overflow-hidden animate-in fade-in zoom-in duration-200\">\n                {/* Header */}\n                <div className=\"px-8 py-6 border-b border-gray-50 bg-gradient-to-br from-gray-50 to-white flex items-center justify-between\">\n                    <div className=\"flex items-center gap-4\">\n                        <div className=\"w-12 h-12 rounded-2xl bg-gray-900 text-white flex items-center justify-center shadow-xl shadow-gray-200\">\n                            <Settings className=\"w-6 h-6\" />\n                        </div>\n                        <div>\n                            <h3 className=\"text-xl font-black text-gray-900 tracking-tight\">System Settings</h3>\n                            <p className=\"text-sm text-gray-500 font-medium\">Configure models and magic numbers</p>\n                        </div>\n                    </div>\n                    <button\n                        onClick={onClose}\n                        className=\"p-2 rounded-xl hover:bg-gray-100 text-gray-400 hover:text-gray-900 transition-all\"\n                    >\n                        <X className=\"w-6 h-6\" />\n                    </button>\n                </div>\n\n                {/* Content */}\n                <div className=\"flex-1 overflow-y-auto p-8 space-y-8 custom-scrollbar\">\n                    {/* Model Config */}\n                    <section className=\"space-y-4\">\n                        <div className=\"flex items-center gap-2 text-gray-900\">\n                            <Cpu className=\"w-5 h-5 text-blue-600\" />\n                            <h4 className=\"font-bold text-sm uppercase tracking-widest\">AI Core Models</h4>\n                        </div>\n\n                        <div className=\"space-y-4\">\n                            <div className=\"space-y-2\">\n                                <label className=\"text-xs font-bold text-gray-500 ml-1\">Text Analysis & Writing (FLASH)</label>\n                                <input\n                                    type=\"text\"\n                                    value={modelFlash}\n                                    onChange={(e) => setModelFlash(e.target.value)}\n                                    className=\"w-full px-4 py-3 bg-gray-50 border border-gray-100 rounded-2xl text-sm font-mono focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 outline-none transition-all\"\n                                    placeholder=\"e.g. gemini-3-flash-preview\"\n                                />\n                            </div>\n\n                            <div className=\"space-y-2\">\n                                <label className=\"text-xs font-bold text-gray-500 ml-1\">Vision & Image Understanding</label>\n                                <input\n                                    type=\"text\"\n                                    value={modelImage}\n                                    onChange={(e) => setModelImage(e.target.value)}\n                                    className=\"w-full px-4 py-3 bg-gray-50 border border-gray-100 rounded-2xl text-sm font-mono focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 outline-none transition-all\"\n                                    placeholder=\"e.g. google/gemini-2.5-flash-image\"\n                                />\n                            </div>\n                        </div>\n                    </section>\n\n                    {/* Magic Numbers */}\n                    <section className=\"space-y-4 pt-4 border-t border-gray-50\">\n                        <div className=\"flex items-center gap-2 text-gray-900\">\n                            <Hash className=\"w-5 h-5 text-emerald-600\" />\n                            <h4 className=\"font-bold text-sm uppercase tracking-widest\">Keyword Logic (NLP)</h4>\n                        </div>\n\n                        <div className=\"grid grid-cols-2 gap-4\">\n                            <div className=\"space-y-2 col-span-2\">\n                                <label className=\"text-xs font-bold text-gray-500 ml-1\">Char count divisor (1 keyword per X chars)</label>\n                                <div className=\"flex items-center gap-3\">\n                                    <input\n                                        type=\"range\"\n                                        min=\"50\"\n                                        max=\"1000\"\n                                        step=\"50\"\n                                        value={keywordCharDivisor}\n                                        onChange={(e) => setKeywordCharDivisor(parseInt(e.target.value))}\n                                        className=\"flex-1 accent-gray-900\"\n                                    />\n                                    <span className=\"w-12 text-center font-bold text-gray-900 bg-gray-50 py-1 rounded-lg border border-gray-100\">{keywordCharDivisor}</span>\n                                </div>\n                            </div>\n\n                            <div className=\"space-y-2\">\n                                <label className=\"text-xs font-bold text-gray-500 ml-1\">Min Keywords</label>\n                                <input\n                                    type=\"number\"\n                                    value={minKeywords}\n                                    onChange={(e) => setMinKeywords(parseInt(e.target.value))}\n                                    className=\"w-full px-4 py-3 bg-gray-50 border border-gray-100 rounded-2xl text-sm font-bold focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 outline-none transition-all\"\n                                />\n                            </div>\n\n                            <div className=\"space-y-2\">\n                                <label className=\"text-xs font-bold text-gray-500 ml-1\">Max Keywords</label>\n                                <input\n                                    type=\"number\"\n                                    value={maxKeywords}\n                                    onChange={(e) => setMaxKeywords(parseInt(e.target.value))}\n                                    className=\"w-full px-4 py-3 bg-gray-50 border border-gray-100 rounded-2xl text-sm font-bold focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 outline-none transition-all\"\n                                />\n                            </div>\n                        </div>\n                        <p className=\"text-[10px] text-gray-400 italic leading-tight\">\n                            Calculation: limit = clamp(min, max, floor(content_length / divisor))\n                        </p>\n                    </section>\n                </div>\n\n                {/* Footer */}\n                <div className=\"px-8 py-6 bg-gray-50/50 border-t border-gray-50 flex items-center justify-between\">\n                    <button\n                        onClick={resetToDefaults}\n                        className=\"flex items-center gap-2 px-4 py-2 text-xs font-bold text-gray-400 hover:text-red-500 transition-colors\"\n                    >\n                        <RotateCcw className=\"w-3.5 h-3.5\" />\n                        Reset Defaults\n                    </button>\n\n                    <div className=\"flex items-center gap-3\">\n                        <button\n                            onClick={onClose}\n                            className=\"px-6 py-2.5 text-sm font-bold text-gray-600 hover:text-gray-900 transition-colors\"\n                        >\n                            Cancel\n                        </button>\n                        <button\n                            onClick={onClose}\n                            className=\"flex items-center gap-2 px-8 py-2.5 bg-gray-900 text-white text-sm font-bold rounded-2xl shadow-xl shadow-gray-200 hover:shadow-gray-300 active:scale-95 transition-all\"\n                        >\n                            <Save className=\"w-4 h-4\" />\n                            Save Config\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n"],"names":[],"mappings":"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"}}]
}